
<!DOCTYPE html>
<html>
<head>
<style>
table {
  font-family: Arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
}

</style>

<body><h2>00040_array_enumerate_uniq.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT max(arrayJoin(arr)) FROM (SELECT arrayEnumerateUniq(groupArray(intDiv(number, 54321)) AS nums, groupArray(toString(intDiv(number, 98765)))) AS arr FROM (SELECT number FROM system.numbers LIMIT 1000000) GROUP BY intHash32(number) % 100000);

SELECT arrayEnumerateUniq([[1], [2], [34], [1]]);
SELECT arrayEnumerateUniq([(1, 2), (3, 4), (1, 2)]);

</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00067_replicate_segfault.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: replica

SELECT arrayFilter(x -> materialize(0), materialize([0])) AS p, arrayAll(y -> arrayExists(x -> y != x, p), p) AS test;
SELECT arrayFilter(x -> materialize(0), materialize([''])) AS p, arrayAll(y -> arrayExists(x -> y != x, p), p) AS test;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00098_f_union_all.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS data2013;
DROP TABLE IF EXISTS data2015;

CREATE TABLE data2013 (name String, value UInt32) ENGINE = Memory;
CREATE TABLE data2015 (data_name String, data_value UInt32) ENGINE = Memory;

INSERT INTO data2013(name,value) VALUES('Alice', 1000);
INSERT INTO data2013(name,value) VALUES('Bob', 2000);
INSERT INTO data2013(name,value) VALUES('Carol', 5000);

INSERT INTO data2015(data_name, data_value) VALUES('Foo', 42);
INSERT INTO data2015(data_name, data_value) VALUES('Bar', 1);

SELECT name FROM (SELECT name FROM data2013 UNION ALL SELECT data_name AS name FROM data2015) ORDER BY name ASC;

DROP TABLE data2013;
DROP TABLE data2015;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00098_h_union_all.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT X FROM (SELECT 1 AS X, 2 AS Y UNION ALL SELECT * FROM (SELECT 3, 4)) ORDER BY X ASC;
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00124_shard_distributed_with_many_replicas.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: replica, distributed

SET allow_experimental_parallel_reading_from_replicas = 0;
SET max_parallel_replicas = 2;
DROP TABLE IF EXISTS report;

set allow_deprecated_syntax_for_merge_tree=1;
CREATE TABLE report(id UInt32, event_date Date, priority UInt32, description String) ENGINE = MergeTree(event_date, intHash32(id), (id, event_date, intHash32(id)), 8192);

INSERT INTO report(id,event_date,priority,description) VALUES (1, '2015-01-01', 1, 'foo')(2, '2015-02-01', 2, 'bar')(3, '2015-03-01', 3, 'foo')(4, '2015-04-01', 4, 'bar')(5, '2015-05-01', 5, 'foo');
SELECT * FROM (SELECT id, event_date, priority, description FROM remote('127.0.0.{2|3}', currentDatabase(), report)) ORDER BY id ASC;

DROP TABLE report;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>00254_tuple_extremes.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>drop table if exists numbers_10;

create table numbers_10 (number UInt64) engine = MergeTree order by number;
insert into numbers_10 select number from system.numbers limit 10;

SELECT number, (number, toDate('2015-01-01') + number) FROM numbers_10 LIMIT 10 SETTINGS extremes = 1;

drop table if exists numbers_10;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00273_quantiles.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT quantiles(0.5)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesExact(0.5)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesTDigest(0.5)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesDeterministic(0.5)(x, x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT arrayMap(a -> round(a, 2), quantilesDD(0.01, 0.5)(x)) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);

SELECT quantiles(0, 0.001, 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99, 0.999, 1)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesExact(0, 0.001, 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99, 0.999, 1)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesTDigest(0, 0.001, 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99, 0.999, 1)(x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT quantilesDeterministic(0, 0.001, 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99, 0.999, 1)(x, x) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);
SELECT arrayMap(a -> round(a, 2), quantilesDD(0.01, 0, 0.001, 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99, 0.999, 1)(x)) FROM (SELECT number AS x FROM system.numbers LIMIT 1001);

-- The result slightly differs but it's ok since `quantilesDeterministic` is an approximate function.
SET max_bytes_before_external_group_by = 0;

SELECT round(1000000 / (number + 1)) AS k, count() AS c, arrayMap(x -> round(x, 6), quantilesDeterministic(0.1, 0.5, 0.9)(number, intHash64(number))) AS q1, quantilesExact(0.1, 0.5, 0.9)(number) AS q2 FROM (SELECT number FROM system.numbers LIMIT 1000000) GROUP BY k ORDER BY k;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00510_materizlized_view_and_deduplication_zookeeper.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: zookeeper, no-ordinary-database, no-parallel
-- Tag no-parallel: static UUID

DROP TABLE IF EXISTS with_deduplication;
DROP TABLE IF EXISTS without_deduplication;
DROP TABLE IF EXISTS with_deduplication_mv;
DROP TABLE IF EXISTS without_deduplication_mv;

CREATE TABLE with_deduplication(x UInt32)
    ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00510/with_deduplication', 'r1') ORDER BY x;
CREATE TABLE without_deduplication(x UInt32)
    ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00510/without_deduplication', 'r1') ORDER BY x SETTINGS replicated_deduplication_window = 0;

CREATE MATERIALIZED VIEW with_deduplication_mv UUID '00000510-1000-4000-8000-000000000001'
    ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/tables/{database}/test_00510/with_deduplication_mv', 'r1') ORDER BY dummy
    AS SELECT 0 AS dummy, countState(x) AS cnt FROM with_deduplication;
CREATE MATERIALIZED VIEW without_deduplication_mv UUID '00000510-1000-4000-8000-000000000002'
    ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/tables/{database}/test_00510/without_deduplication_mv', 'r1') ORDER BY dummy
    AS SELECT 0 AS dummy, countState(x) AS cnt FROM without_deduplication;

INSERT INTO with_deduplication VALUES (42);
INSERT INTO with_deduplication VALUES (42);
INSERT INTO with_deduplication VALUES (43);

INSERT INTO without_deduplication VALUES (42);
INSERT INTO without_deduplication VALUES (42);
INSERT INTO without_deduplication VALUES (43);

SELECT count() FROM with_deduplication;
SELECT count() FROM without_deduplication;

-- Implicit insert isn't deduplicated
SELECT '';
SELECT countMerge(cnt) FROM with_deduplication_mv;
SELECT countMerge(cnt) FROM without_deduplication_mv;

-- Explicit insert is deduplicated
ALTER TABLE `.inner_id.00000510-1000-4000-8000-000000000001` DROP PARTITION ID 'all';
ALTER TABLE `.inner_id.00000510-1000-4000-8000-000000000002` DROP PARTITION ID 'all';
INSERT INTO `.inner_id.00000510-1000-4000-8000-000000000001` SELECT 0 AS dummy, arrayReduce('countState', [toUInt32(42)]) AS cnt;
INSERT INTO `.inner_id.00000510-1000-4000-8000-000000000001` SELECT 0 AS dummy, arrayReduce('countState', [toUInt32(42)]) AS cnt;
INSERT INTO `.inner_id.00000510-1000-4000-8000-000000000002` SELECT 0 AS dummy, arrayReduce('countState', [toUInt32(42)]) AS cnt;
INSERT INTO `.inner_id.00000510-1000-4000-8000-000000000002` SELECT 0 AS dummy, arrayReduce('countState', [toUInt32(42)]) AS cnt;

SELECT '';
SELECT countMerge(cnt) FROM with_deduplication_mv;
SELECT countMerge(cnt) FROM without_deduplication_mv;

DROP TABLE IF EXISTS with_deduplication;
DROP TABLE IF EXISTS without_deduplication;
DROP TABLE IF EXISTS with_deduplication_mv;
DROP TABLE IF EXISTS without_deduplication_mv;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00513_fractional_time_zones.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>WITH toDateTime(1509138000) + number * 300 AS t SELECT toHour(t, 'Asia/Kolkata') AS h, toString(toStartOfHour(t, 'Asia/Kolkata'), 'Asia/Kolkata') AS h_start FROM system.numbers LIMIT 12;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>00562_in_subquery_merge_tree.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS merge_tree_in_subqueries;
CREATE TABLE merge_tree_in_subqueries (id UInt64, name String, num UInt64) ENGINE = MergeTree ORDER BY (id, name);
INSERT INTO merge_tree_in_subqueries VALUES(1, 'test1', 42);
INSERT INTO merge_tree_in_subqueries VALUES(2, 'test2', 8);
INSERT INTO merge_tree_in_subqueries VALUES(3, 'test3', 8);
INSERT INTO merge_tree_in_subqueries VALUES(4, 'test4', 1985);
INSERT INTO merge_tree_in_subqueries VALUES(5, 'test5', 0);

-- Index scans.
SET force_primary_key = 1;

SELECT * FROM merge_tree_in_subqueries WHERE id IN (SELECT * FROM system.numbers LIMIT 0);

SELECT * FROM merge_tree_in_subqueries WHERE id IN (SELECT * FROM system.numbers LIMIT 2, 3) ORDER BY id;
SELECT * FROM merge_tree_in_subqueries WHERE name IN (SELECT 'test' || toString(number) FROM system.numbers LIMIT 2, 3) ORDER BY id;

SELECT id AS id2, name AS value FROM merge_tree_in_subqueries WHERE (value, id2) IN (SELECT 'test' || toString(number), number FROM system.numbers LIMIT 2, 3) ORDER BY id;

-- Non-index scans.
SET force_primary_key = 0;

SELECT id AS id2, name AS value FROM merge_tree_in_subqueries WHERE num IN (SELECT number FROM system.numbers LIMIT 10) ORDER BY id;
SELECT id AS id2, name AS value FROM merge_tree_in_subqueries WHERE (id, num) IN (SELECT number, number + 6 FROM system.numbers LIMIT 10) ORDER BY id;

DROP TABLE IF EXISTS merge_tree_in_subqueries;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00578_merge_table_and_table_virtual_column.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS numbers1;
DROP TABLE IF EXISTS numbers2;
DROP TABLE IF EXISTS numbers3;
DROP TABLE IF EXISTS numbers4;
DROP TABLE IF EXISTS numbers5;

CREATE TABLE numbers1 ENGINE = StripeLog AS SELECT number FROM numbers(1000);
CREATE TABLE numbers2 ENGINE = TinyLog AS SELECT number FROM numbers(1000);
CREATE TABLE numbers3 ENGINE = Log AS SELECT number FROM numbers(1000);
CREATE TABLE numbers4 ENGINE = Memory AS SELECT number FROM numbers(1000);
CREATE TABLE numbers5 ENGINE = MergeTree ORDER BY number AS SELECT number FROM numbers(1000);

SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$');
SELECT DISTINCT count() FROM merge(currentDatabase(), '^numbers\\d+$') GROUP BY number;

SET optimize_aggregation_in_order = 0; -- FIXME : in order may happen before filter push down

SET max_rows_to_read = 1000;

SET max_threads = 'auto';
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'numbers1';

SET max_threads = 1;
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'numbers2';

SET max_threads = 10;
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'numbers3';

SET max_rows_to_read = 1;

SET max_threads = 'auto';
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'non_existing';

SET max_threads = 1;
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'non_existing';

SET max_threads = 10;
SELECT count() FROM merge(currentDatabase(), '^numbers\\d+$') WHERE _table = 'non_existing';

DROP TABLE numbers1;
DROP TABLE numbers2;
DROP TABLE numbers3;
DROP TABLE numbers4;
DROP TABLE numbers5;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00622_select_in_parens.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>(SELECT 1);
(SELECT 2) UNION ALL (SELECT 2);
((SELECT (((3)))));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00624_length_utf8.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT 'привет пр' AS x, lengthUTF8(x) AS y;
SELECT x, lengthUTF8(x) AS y FROM (SELECT arrayJoin(['', 'h', 'hello', 'hello hello hello', 'п', 'пр', 'привет', 'привет привет', 'привет привет привет', '你好', '你好 你好', '你好你好你好', '你好你好你好你好', '你好 你好 你好 你好 你好']) AS x);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00653_monotonic_integer_cast.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>drop table if exists `table_00653`;
create table `table_00653` (val Int32) engine = MergeTree order by val;
insert into `table_00653` values (-2), (0), (2);
select count() from `table_00653` where toUInt64(val) == 0;
drop table table_00653;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00709_virtual_column_partition_id.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS partition_id;

set allow_deprecated_syntax_for_merge_tree=1;
CREATE TABLE IF NOT EXISTS partition_id (d Date DEFAULT '2000-01-01', x UInt64) ENGINE = MergeTree(d, x, 5);

INSERT INTO partition_id VALUES (100, 1), (200, 2), (300, 3);

SELECT _partition_id FROM partition_id ORDER BY x;

DROP TABLE IF EXISTS partition_id;

</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00725_memory_tracking.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-replicated-database

SELECT least(value, 0) FROM system.metrics WHERE metric = 'MemoryTracking';
SELECT length(range(100000000));
SELECT least(value, 0) FROM system.metrics WHERE metric = 'MemoryTracking';
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00732_quorum_insert_lost_part_and_alive_part_zookeeper_long.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: long, zookeeper, no-replicated-database
-- Tag no-replicated-database: Fails due to additional replicas or shards

SET send_logs_level = 'fatal';

DROP TABLE IF EXISTS quorum1;
DROP TABLE IF EXISTS quorum2;

CREATE TABLE quorum1(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00732/quorum_lost_alive', '1') ORDER BY x PARTITION BY y;
CREATE TABLE quorum2(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00732/quorum_lost_alive', '2') ORDER BY x PARTITION BY y;

SET insert_quorum=2, insert_quorum_parallel=0;
SET select_sequential_consistency=1;

INSERT INTO quorum1 VALUES (1, '2018-11-15');
INSERT INTO quorum1 VALUES (2, '2018-11-15');
INSERT INTO quorum1 VALUES (3, '2018-12-16');

SET insert_quorum_timeout=0;

SYSTEM STOP FETCHES quorum1;

INSERT INTO quorum2 VALUES (4, toDate('2018-12-16')); -- { serverError 319 }

SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;

SET select_sequential_consistency=0;

SELECT x FROM quorum2 ORDER BY x;

SET select_sequential_consistency=1;

SYSTEM START FETCHES quorum1;
SYSTEM SYNC REPLICA quorum1;

SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;

DROP TABLE quorum1;
DROP TABLE quorum2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>00732_quorum_insert_lost_part_zookeeper_long.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: long, zookeeper, no-replicated-database
-- Tag no-replicated-database: Fails due to additional replicas or shards

SET send_logs_level = 'fatal';

DROP TABLE IF EXISTS quorum1;
DROP TABLE IF EXISTS quorum2;

CREATE TABLE quorum1(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00732/quorum_lost', '1') ORDER BY x PARTITION BY y;
CREATE TABLE quorum2(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_00732/quorum_lost', '2') ORDER BY x PARTITION BY y;

SET insert_quorum=2, insert_quorum_parallel=0;
SET select_sequential_consistency=1;

SET insert_quorum_timeout=0;

SYSTEM STOP FETCHES quorum1;

INSERT INTO quorum2 VALUES (1, '2018-11-15'); -- { serverError 319 }

SELECT count(*) FROM quorum1;
SELECT count(*) FROM quorum2;

SET select_sequential_consistency=0;

SELECT x FROM quorum2 ORDER BY x;
SET select_sequential_consistency=1;

SET insert_quorum_timeout=100;

SYSTEM START FETCHES quorum1;
SYSTEM SYNC REPLICA quorum1;

SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;

DROP TABLE quorum1;
DROP TABLE quorum2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>00755_avg_value_size_hint_passing.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS size_hint;
CREATE TABLE size_hint (s Array(String)) ENGINE = MergeTree ORDER BY tuple() SETTINGS index_granularity = 1000, index_granularity_bytes = '10Mi';

SET max_block_size = 1000;
SET max_memory_usage = 1000000000;
INSERT INTO size_hint SELECT arrayMap(x -> 'Hello', range(1000)) FROM numbers(10000);

SET max_memory_usage = 100000000, max_threads = 2;
SELECT count(), sum(length(s)) FROM size_hint;

DROP TABLE size_hint;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00833_sleep_overflow.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT sleep(4295.967296); -- { serverError 160 }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>00836_indices_alter.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS minmax_idx;
DROP TABLE IF EXISTS minmax_idx2;


CREATE TABLE minmax_idx
(
    u64 UInt64,
    i32 Int32
) ENGINE = MergeTree()
ORDER BY u64;

INSERT INTO minmax_idx VALUES (1, 2);

ALTER TABLE minmax_idx ADD INDEX idx1 u64 * i32 TYPE minmax GRANULARITY 10;
ALTER TABLE minmax_idx ADD INDEX idx2 u64 + i32 TYPE minmax GRANULARITY 10;
ALTER TABLE minmax_idx ADD INDEX idx3 (u64 - i32) TYPE minmax GRANULARITY 10 AFTER idx1;

SHOW CREATE TABLE minmax_idx;

SELECT * FROM minmax_idx WHERE u64 * i32 = 2;

INSERT INTO minmax_idx VALUES (1, 2);
INSERT INTO minmax_idx VALUES (1, 2);
INSERT INTO minmax_idx VALUES (1, 2);
INSERT INTO minmax_idx VALUES (1, 2);
INSERT INTO minmax_idx VALUES (1, 2);

SELECT * FROM minmax_idx WHERE u64 * i32 = 2;

ALTER TABLE minmax_idx DROP INDEX idx1;

SHOW CREATE TABLE minmax_idx;

SELECT * FROM minmax_idx WHERE u64 * i32 = 2;

ALTER TABLE minmax_idx DROP INDEX idx2;
ALTER TABLE minmax_idx DROP INDEX idx3;

SHOW CREATE TABLE minmax_idx;

ALTER TABLE minmax_idx ADD INDEX idx1 (u64 * i32) TYPE minmax GRANULARITY 10;

SHOW CREATE TABLE minmax_idx;

SELECT * FROM minmax_idx WHERE u64 * i32 = 2;


CREATE TABLE minmax_idx2
(
    u64 UInt64,
    i32 Int32,
    INDEX idx1 (u64 + i32) TYPE minmax GRANULARITY 10,
    INDEX idx2 u64 * i32 TYPE minmax GRANULARITY 10
) ENGINE = MergeTree()
ORDER BY u64;

INSERT INTO minmax_idx2 VALUES (1, 2);
INSERT INTO minmax_idx2 VALUES (1, 2);

SELECT * FROM minmax_idx2 WHERE u64 * i32 = 2;

ALTER TABLE minmax_idx2 DROP INDEX idx1, DROP INDEX idx2;

SHOW CREATE TABLE minmax_idx2;

SELECT * FROM minmax_idx2 WHERE u64 * i32 = 2;

DROP TABLE minmax_idx;
DROP TABLE minmax_idx2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00852_any_join_nulls.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS table1;
DROP TABLE IF EXISTS table2;
CREATE TABLE table1 ( id String ) ENGINE = Log;
CREATE TABLE table2 ( parent_id String ) ENGINE = Log;

insert into table1 values ('1');

SELECT table2.parent_id = '', isNull(table2.parent_id)
FROM table1 ANY LEFT JOIN table2 ON table1.id = table2.parent_id;

SET join_use_nulls = 1;

SELECT table2.parent_id = '', isNull(table2.parent_id)
FROM table1 ANY LEFT JOIN table2 ON table1.id = table2.parent_id;

DROP TABLE table1;
DROP TABLE table2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>00950_test_gorilla_codec.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS codecTest;

SET cross_to_inner_join_rewrite = 1;

CREATE TABLE codecTest (
    key      UInt64,
    name     String,
    ref_valueF64 Float64,
    ref_valueF32 Float32,
    valueF64 Float64  CODEC(Gorilla),
    valueF32 Float32  CODEC(Gorilla)
) Engine = MergeTree ORDER BY key;

-- best case - same value
INSERT INTO codecTest (key, name, ref_valueF64, valueF64, ref_valueF32, valueF32)
	SELECT number AS n, 'e()', e() AS v, v, v, v FROM system.numbers LIMIT 1, 100;

-- good case - values that grow insignificantly
INSERT INTO codecTest (key, name, ref_valueF64, valueF64, ref_valueF32, valueF32)
	SELECT number AS n, 'log2(n)', log2(n) AS v, v, v, v FROM system.numbers LIMIT 101, 100;

-- bad case - values differ significantly
INSERT INTO codecTest (key, name, ref_valueF64, valueF64, ref_valueF32, valueF32)
	SELECT number AS n, 'n*sqrt(n)', n*sqrt(n) AS v, v, v, v FROM system.numbers LIMIT 201, 100;

-- worst case - almost like a random values
INSERT INTO codecTest (key, name, ref_valueF64, valueF64, ref_valueF32, valueF32)
	SELECT number AS n, 'sin(n*n*n)*n', sin(n * n * n * n* n) AS v, v, v, v FROM system.numbers LIMIT 301, 100;


-- These floating-point values are expected to be BINARY equal, so comparing by-value is Ok here.

-- referencing previous row key, value, and case name to simplify debugging.
SELECT 'F64';
SELECT
	c1.key, c1.name,
	c1.ref_valueF64, c1.valueF64, c1.ref_valueF64 - c1.valueF64 AS dF64,
	'prev:',
	c2.key, c2.ref_valueF64
FROM
	codecTest as c1, codecTest as c2
WHERE
	dF64 != 0
AND
	c2.key = c1.key - 1
LIMIT 10;


SELECT 'F32';
SELECT
	c1.key, c1.name,
	c1.ref_valueF32, c1.valueF32, c1.ref_valueF32 - c1.valueF32 AS dF32,
	'prev:',
	c2.key, c2.ref_valueF32
FROM
	codecTest as c1, codecTest as c2
WHERE
	dF32 != 0
AND
	c2.key = c1.key - 1
LIMIT 10;

DROP TABLE IF EXISTS codecTest;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01042_check_query_and_last_granule_size.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET check_query_single_value_result = 0;
DROP TABLE IF EXISTS check_query_test;

CREATE TABLE check_query_test (SomeKey UInt64, SomeValue String) ENGINE = MergeTree() ORDER BY SomeKey SETTINGS min_bytes_for_wide_part = 0, min_rows_for_wide_part = 0;

-- Number of rows in last granule should be equals to granularity.
-- Rows in this table are short, so granularity will be 8192.
INSERT INTO check_query_test SELECT number, toString(number) FROM system.numbers LIMIT 81920;

CHECK TABLE check_query_test SETTINGS max_threads = 1;

OPTIMIZE TABLE check_query_test;

CHECK TABLE check_query_test SETTINGS max_threads = 1;

DROP TABLE IF EXISTS check_query_test;

DROP TABLE IF EXISTS check_query_test_non_adaptive;

CREATE TABLE check_query_test_non_adaptive (SomeKey UInt64, SomeValue String) ENGINE = MergeTree() ORDER BY SomeKey SETTINGS index_granularity_bytes = 0, min_bytes_for_wide_part = 0, min_rows_for_wide_part = 0;

INSERT INTO check_query_test_non_adaptive SELECT number, toString(number) FROM system.numbers LIMIT 81920;

CHECK TABLE check_query_test_non_adaptive SETTINGS max_threads = 1;

OPTIMIZE TABLE check_query_test_non_adaptive;

CHECK TABLE check_query_test_non_adaptive SETTINGS max_threads = 1;

INSERT INTO check_query_test_non_adaptive SELECT number, toString(number) FROM system.numbers LIMIT 77;

CHECK TABLE check_query_test_non_adaptive SETTINGS max_threads = 1;

OPTIMIZE TABLE check_query_test_non_adaptive;

CHECK TABLE check_query_test_non_adaptive SETTINGS max_threads = 1;

DROP TABLE IF EXISTS check_query_test_non_adaptive;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01074_h3_range_check.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest

SELECT h3EdgeLengthM(100); -- { serverError 69 }
SELECT h3HexAreaM2(100); -- { serverError 69 }
SELECT h3HexAreaKm2(100); -- { serverError 69 }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01087_storage_generate.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS test_table;
CREATE TABLE test_table(a Array(Int8), d Decimal32(4), c Tuple(DateTime64(3), UUID)) ENGINE = GenerateRandom();
SELECT COUNT(*) FROM (SELECT * FROM test_table LIMIT 100);

DROP TABLE IF EXISTS test_table;

SELECT '-';

DROP TABLE IF EXISTS test_table_2;
CREATE TABLE test_table_2(a Array(Int8), d Decimal32(4), c Tuple(DateTime64(3, 'UTC'), UUID)) ENGINE = GenerateRandom(10, 5, 3);

SELECT * FROM test_table_2 LIMIT 100;

SELECT '-';

DROP TABLE IF EXISTS test_table_2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01106_const_fixed_string_like.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT CAST('hello' AS FixedString(5)) LIKE 'hello';
SELECT CAST('hello' AS FixedString(5)) LIKE 'world';
SELECT CAST('hello' AS FixedString(5)) LIKE 'xyz';
SELECT CAST('hello' AS FixedString(5)) LIKE 'hell';
SELECT CAST('hello' AS FixedString(5)) LIKE 'orld';

SELECT CAST('hello' AS FixedString(5)) LIKE '%hello%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%world%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%xyz%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%hell%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%orld%';

SELECT CAST('hello' AS FixedString(5)) LIKE '%hello';
SELECT CAST('hello' AS FixedString(5)) LIKE '%world';
SELECT CAST('hello' AS FixedString(5)) LIKE '%xyz';
SELECT CAST('hello' AS FixedString(5)) LIKE '%hell';
SELECT CAST('hello' AS FixedString(5)) LIKE '%orld';

SELECT CAST('hello' AS FixedString(5)) LIKE 'hello%';
SELECT CAST('hello' AS FixedString(5)) LIKE 'world%';
SELECT CAST('hello' AS FixedString(5)) LIKE 'xyz%';
SELECT CAST('hello' AS FixedString(5)) LIKE 'hell%';
SELECT CAST('hello' AS FixedString(5)) LIKE 'orld%';

SELECT CAST('hello' AS FixedString(5)) LIKE '%he%o%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%w%ld%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%x%z%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%hell_';
SELECT CAST('hello' AS FixedString(5)) LIKE '_orld%';

SELECT CAST('hello' AS FixedString(5)) LIKE '%he__o%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%w__ld%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%x%z%';
SELECT CAST('hello' AS FixedString(5)) LIKE 'hell_';
SELECT CAST('hello' AS FixedString(5)) LIKE '_orld';

SELECT CAST('hello' AS FixedString(5)) LIKE 'helloworld';
SELECT CAST('hello' AS FixedString(5)) LIKE '%helloworld%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%elloworl%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%ow%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%o%w%';

SELECT CAST('hello' AS FixedString(5)) LIKE '%o%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%l%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%l%o%';
SELECT CAST('hello' AS FixedString(5)) LIKE '%o%l%';
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01129_dict_get_join_lose_constness.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-parallel

DROP DICTIONARY IF EXISTS system.dict1;

CREATE DICTIONARY IF NOT EXISTS system.dict1
(
    bytes_allocated UInt64,
    element_count Int32,
    loading_start_time DateTime
)
PRIMARY KEY bytes_allocated
SOURCE(CLICKHOUSE(HOST 'localhost' PORT tcpPort() USER 'default' PASSWORD '' TABLE 'dictionaries' DB 'system'))
LIFETIME(0)
LAYOUT(hashed());

SELECT join_key,
       toTimeZone(dictGetDateTime('system.dict1', 'loading_start_time', toUInt64(dict_key)), 'UTC') AS datetime
FROM (select dictGetInt32('system.dict1', 'element_count', toUInt64(dict_key)) AS join_key, 1 AS dict_key) js1
LEFT JOIN (SELECT toInt32(2) AS join_key) js2
USING (join_key)
WHERE now() >= datetime;

DROP DICTIONARY IF EXISTS system.dict1;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01141_join_get_negative.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;

CREATE TABLE t1 (`s` String, `x` Array(UInt8), `k` UInt64) ENGINE = Join(ANY, LEFT, k);
CREATE TABLE t2 (`s` String, `x` Array(UInt8), `k` UInt64) ENGINE = Join(ANY, INNER, k);

SELECT joinGet('t1', '', number) FROM numbers(2); -- { serverError 16 }
SELECT joinGet('t2', 's', number) FROM numbers(2); -- { serverError 264 }

DROP TABLE t1;
DROP TABLE t2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01262_low_cardinality_remove.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS testView;
DROP TABLE IF EXISTS testTable;

CREATE TABLE IF NOT EXISTS testTable (
 A LowCardinality(String), -- like voter
 B Int64
) ENGINE MergeTree()
ORDER BY (A);

INSERT INTO testTable VALUES ('A', 1),('B',2),('C',3);

CREATE VIEW testView AS 
SELECT
 A as ALow, -- like account
 B
FROM
   testTable;

SELECT CAST(ALow, 'String') AS AStr
FROM testView
GROUP BY AStr ORDER BY AStr;

DROP TABLE testTable;

CREATE TABLE IF NOT EXISTS testTable (
 A String, -- like voter
 B Int64
) ENGINE MergeTree()
ORDER BY (A);

SELECT CAST(ALow, 'String') AS AStr
FROM testView
GROUP BY AStr ORDER BY AStr;

INSERT INTO testTable VALUES ('A', 1),('B',2),('C',3);

SELECT CAST(ALow, 'String') AS AStr
FROM testView
GROUP BY AStr ORDER BY AStr;

DROP TABLE IF EXISTS testView;
DROP TABLE IF EXISTS testTable;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01302_polygons_distance.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>select polygonsDistanceCartesian([[[(0, 0),(0, 3),(1, 2.9),(2, 2.6),(2.6, 2),(2.9, 1),(3, 0),(0, 0)]]], [[[(1., 1.),(1., 4.),(4., 4.),(4., 1.),(1., 1.)]]]);
select polygonsDistanceCartesian([[[(0, 0), (0, 0.1), (0.1, 0.1), (0.1, 0)]]], [[[(1., 1.),(1., 4.),(4., 4.),(4., 1.),(1., 1.)]]]);
select polygonsDistanceSpherical([[[(23.725750, 37.971536)]]], [[[(4.3826169, 50.8119483)]]]);

drop table if exists polygon_01302;
create table polygon_01302 (x Array(Array(Array(Tuple(Float64, Float64)))), y Array(Array(Array(Tuple(Float64, Float64))))) engine=Memory();
insert into polygon_01302 values ([[[(23.725750, 37.971536)]]], [[[(4.3826169, 50.8119483)]]]);
select polygonsDistanceSpherical(x, y) from polygon_01302;

drop table polygon_01302;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01353_neighbor_overflow.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET allow_deprecated_functions = 1;
SELECT neighbor(toString(number), -9223372036854775808) FROM numbers(100); -- { serverError 69 }
WITH neighbor(toString(number), toInt64(rand64())) AS x SELECT * FROM system.numbers WHERE NOT ignore(x); -- { serverError 69 }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01391_join_on_dict_crash.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-parallel

DROP DATABASE IF EXISTS db_01391;
CREATE DATABASE db_01391;
USE db_01391;

DROP TABLE IF EXISTS t;
DROP TABLE IF EXISTS d_src;
DROP DICTIONARY IF EXISTS d;

CREATE TABLE t (click_city_id UInt32, click_country_id UInt32) Engine = Memory;
CREATE TABLE d_src (id UInt64, country_id UInt8, name String) Engine = Memory;

INSERT INTO t VALUES (0, 0);
INSERT INTO d_src VALUES (0, 0, 'n');

CREATE DICTIONARY d (id UInt32, country_id UInt8, name String)
PRIMARY KEY id
SOURCE(CLICKHOUSE(HOST 'localhost' PORT tcpPort() USER 'default' DB 'db_01391' table 'd_src'))
LIFETIME(MIN 1 MAX 1)
LAYOUT(HASHED());

SELECT click_country_id FROM t AS cc LEFT JOIN d ON toUInt32(d.id) = cc.click_city_id;
SELECT click_country_id FROM t AS cc LEFT JOIN d ON d.country_id < 99 AND d.id = cc.click_city_id;

DROP DICTIONARY d;
DROP TABLE t;
DROP TABLE d_src;
DROP DATABASE IF EXISTS db_01391;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01413_if_array_uuid.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT if(number % 2 = 0, [toUUID('00000000-e1fe-11e9-bb8f-853d60c00749')], [toUUID('11111111-e1fe-11e9-bb8f-853d60c00749')]) FROM numbers(5);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01441_array_combinator.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT number % 100 AS k, sumArray(emptyArrayUInt8()) AS v FROM numbers(10) GROUP BY k ORDER BY k;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01451_replicated_detach_drop_part_long.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: long, replica, no-replicated-database
-- Tag no-replicated-database: Fails due to additional replicas or shards

SET replication_alter_partitions_sync = 2;

DROP TABLE IF EXISTS replica1 SYNC;
DROP TABLE IF EXISTS replica2 SYNC;

CREATE TABLE replica1 (v UInt8) ENGINE = ReplicatedMergeTree('/clickhouse/tables/{database}/'||currentDatabase()||'test/01451/attach', 'r1') order by tuple() settings max_replicated_merges_in_queue = 0;
CREATE TABLE replica2 (v UInt8) ENGINE = ReplicatedMergeTree('/clickhouse/tables/{database}/'||currentDatabase()||'test/01451/attach', 'r2') order by tuple() settings max_replicated_merges_in_queue = 0;

INSERT INTO replica1 SETTINGS insert_keeper_fault_injection_probability=0 VALUES (0);
INSERT INTO replica1 SETTINGS insert_keeper_fault_injection_probability=0 VALUES (1);
INSERT INTO replica1 SETTINGS insert_keeper_fault_injection_probability=0 VALUES (2);

ALTER TABLE replica1 DETACH PART 'all_100_100_0'; -- { serverError 232 }

SELECT v FROM replica1 ORDER BY v;

SYSTEM SYNC REPLICA replica2;
ALTER TABLE replica2 DETACH PART 'all_1_1_0';

SELECT v FROM replica1 ORDER BY v;

SELECT name FROM system.detached_parts WHERE table = 'replica2' AND database = currentDatabase();

ALTER TABLE replica2 ATTACH PART 'all_1_1_0' SETTINGS insert_keeper_fault_injection_probability=0;

SYSTEM SYNC REPLICA replica1;
SELECT v FROM replica1 ORDER BY v;

SELECT name FROM system.detached_parts WHERE table = 'replica2' AND database = currentDatabase();

SELECT '-- drop part --';

ALTER TABLE replica1 DROP PART 'all_3_3_0';

ALTER TABLE replica1 ATTACH PART 'all_3_3_0'; -- { serverError 233 }

SELECT v FROM replica1 ORDER BY v;

SELECT '-- resume merges --';

ALTER TABLE replica1 MODIFY SETTING max_replicated_merges_in_queue = 1;
OPTIMIZE TABLE replica1 FINAL;

SELECT v FROM replica1 ORDER BY v;

SELECT name FROM system.parts WHERE table = 'replica2' AND active AND database = currentDatabase();

DROP TABLE replica1 SYNC;
DROP TABLE replica2 SYNC;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01514_input_format_csv_enum_as_number_setting.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS table_with_enum_column_for_csv_insert;

CREATE TABLE table_with_enum_column_for_csv_insert (
    Id Int32,
    Value Enum('ef' = 1, 'es' = 2)
) ENGINE=Memory();

SET input_format_csv_enum_as_number = 1;

INSERT INTO table_with_enum_column_for_csv_insert FORMAT CSV 102,2
SELECT * FROM table_with_enum_column_for_csv_insert;

SET input_format_csv_enum_as_number = 0;

DROP TABLE IF EXISTS table_with_enum_column_for_csv_insert;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01620_fix_simple_state_arg_type.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>drop table if exists ay;

create table ay engine AggregatingMergeTree order by i as select 1 i, sumSimpleState(10) group by i;
insert into ay values(40, 60);
insert into ay values(40, 50);
insert into ay values(20, 30);
optimize table ay;
select * from ay;
insert into ay values(20, 30), (40, 10);
optimize table ay;
select * from ay;

drop table if exists ay;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01642_if_nullable_regression.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT sumIf(dummy, dummy) FROM remote('127.0.0.{1,2}', view(SELECT cast(Null  AS Nullable(UInt8))  AS dummy FROM system.one));
SELECT sumIf(dummy, 1)     FROM remote('127.0.0.{1,2}', view(SELECT cast(Null  AS Nullable(UInt8))  AS dummy FROM system.one));
-- Before #16610 it returns 0 while with this patch it will return NULL
SELECT sumIf(dummy, dummy) FROM remote('127.0.0.{1,2}', view(SELECT cast(dummy AS Nullable(UInt8)) AS dummy FROM system.one));
SELECT sumIf(dummy, 1)     FROM remote('127.0.0.{1,2}', view(SELECT cast(dummy AS Nullable(UInt8)) AS dummy FROM system.one));

SELECT sumIf(n, 1) FROM remote('127.0.0.{1,2}', view(SELECT cast(* AS Nullable(UInt8)) AS n FROM system.numbers limit 10))
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01645_system_table_engines.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT * FROM system.table_engines WHERE name in ('MergeTree', 'ReplicatedCollapsingMergeTree') ORDER BY name FORMAT PrettyCompactNoEscapes;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01671_merge_join_and_constants.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET output_format_pretty_color=1;
SET allow_experimental_analyzer = 1;

DROP TABLE IF EXISTS table1;
DROP TABLE IF EXISTS table2;

CREATE TABLE table1(a String, b Date) ENGINE MergeTree order by a;
CREATE TABLE table2(c String, a String, d Date) ENGINE MergeTree order by c;

INSERT INTO table1 VALUES ('a', '2018-01-01') ('b', '2018-01-01') ('c', '2018-01-01');
INSERT INTO table2 VALUES ('D', 'd', '2018-01-01') ('B', 'b', '2018-01-01') ('C', 'c', '2018-01-01');

set join_algorithm = 'partial_merge';

SELECT * FROM table1 AS t1 ALL LEFT JOIN (SELECT *, '0.10', c, d AS b FROM table2) AS t2 USING (a, b) ORDER BY d, t1.a ASC FORMAT PrettyCompact settings max_rows_in_join = 1;

SELECT pow('0.0000000257', NULL), pow(pow(NULL, NULL), NULL) - NULL, (val + NULL) = (rval * 0), * FROM (SELECT (val + 256) = (NULL * NULL), toLowCardinality(toNullable(dummy)) AS val FROM system.one) AS s1 ANY LEFT JOIN (SELECT toLowCardinality(dummy) AS rval FROM system.one) AS s2 ON (val + 0) = (rval * 255) settings max_rows_in_join = 1;

DROP TABLE IF EXISTS table1;
DROP TABLE IF EXISTS table2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01776_decrypt_aead_size_check.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest
-- Tag no-fasttest: Depends on OpenSSL

SELECT decrypt('aes-128-gcm', 'text', 'key', 'IV'); -- { serverError 36 }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01795_TinyLog_rwlock_ub.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS underlying_01795;
CREATE TABLE underlying_01795 (key UInt64) Engine=TinyLog();
INSERT INTO FUNCTION remote('127.1', currentDatabase(), underlying_01795) SELECT toUInt64(number) FROM system.numbers LIMIT 1;
SELECT * FROM underlying_01795 FORMAT Null;
DROP TABLE underlying_01795;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01825_type_json_in_array.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest

SET allow_experimental_object_type = 1;
DROP TABLE IF EXISTS t_json_array;

CREATE TABLE t_json_array (id UInt32, arr Array(JSON)) ENGINE = MergeTree ORDER BY id;

INSERT INTO t_json_array FORMAT JSONEachRow {"id": 1, "arr": [{"k1": 1, "k2": {"k3": 2, "k4": 3}}, {"k1": 2, "k2": {"k5": "foo"}}]}
INSERT INTO t_json_array FORMAT JSONEachRow {"id": 2, "arr": [{"k1": 3, "k2": {"k3": 4, "k4": 5}}]}

SET output_format_json_named_tuples_as_objects = 1;

SELECT * FROM t_json_array ORDER BY id FORMAT JSONEachRow;
SELECT id, arr.k1, arr.k2.k3, arr.k2.k4, arr.k2.k5 FROM t_json_array ORDER BY id;
SELECT arr FROM t_json_array ARRAY JOIN arr ORDER BY arr.k1 FORMAT JSONEachRow;
SELECT toTypeName(arr) FROM t_json_array LIMIT 1;

TRUNCATE TABLE t_json_array;

INSERT INTO t_json_array FORMAT JSONEachRow {"id": 1, "arr": [{"k1": [{"k2": "aaa", "k3": "bbb"}, {"k2": "ccc"}]}]}
INSERT INTO t_json_array FORMAT JSONEachRow {"id": 2, "arr": [{"k1": [{"k3": "ddd", "k4": 10}, {"k4": 20}], "k5": {"k6": "foo"}}]}

SELECT * FROM t_json_array ORDER BY id FORMAT JSONEachRow;
SELECT id, arr.k1.k2, arr.k1.k3, arr.k1.k4, arr.k5.k6 FROM t_json_array ORDER BY id;

SELECT arrayJoin(arrayJoin(arr.k1)) AS k1 FROM t_json_array ORDER BY k1 FORMAT JSONEachRow;
SELECT toTypeName(arrayJoin(arrayJoin(arr.k1))) AS arr FROM t_json_array LIMIT 1;

DROP TABLE t_json_array;

SELECT * FROM values('arr Array(JSON)', '[\'{"x" : 1}\']') FORMAT JSONEachRow;
SELECT * FROM values('arr Map(String, JSON)', '{\'x\' : \'{"y" : 1}\', \'t\' : \'{"y" : 2}\'}') FORMAT JSONEachRow;
SELECT * FROM values('arr Tuple(Int32, JSON)', '(1, \'{"y" : 1}\')', '(2, \'{"y" : 2}\')') FORMAT JSONEachRow;
SELECT * FROM format(JSONEachRow, '{"arr" : [{"x" : "aaa", "y" : [1,2,3]}]}') FORMAT JSONEachRow;
SELECT * FROM values('arr Array(JSON)', '[\'{"x" : 1}\']') FORMAT JSONEachRow;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01913_names_of_tuple_literal.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET allow_experimental_analyzer = 0;

SELECT ((1, 2), (2, 3), (3, 4)) FORMAT TSVWithNames;
SELECT ((1, 2), (2, 3), (3, 4)) FORMAT TSVWithNames SETTINGS legacy_column_name_of_tuple_literal = 1;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01915_json_extract_raw_string.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>
select JSONExtract('{"a": "123", "b": 456, "c": [7, 8, 9]}', 'Tuple(a String, b String, c String)');

with '{"string_value":null}' as json select JSONExtract(json, 'string_value', 'Nullable(String)');
with '{"string_value":null}' as json select JSONExtract(json, 'string_value', 'LowCardinality(Nullable(String))');

select JSONExtractString('{"a": 123}', 'a');
select JSONExtractString('{"a": "123"}', 'a');
select JSONExtractString('{"a": null}', 'a');
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01931_storage_merge_no_columns.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>drop table if exists data;
create table data (key Int) engine=MergeTree() order by key;
select 1 from merge(currentDatabase(), '^data$') prewhere _table in (NULL); -- { serverError ILLEGAL_PREWHERE }
select 1 from merge(currentDatabase(), '^data$') where _table in (NULL);
drop table data;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>01932_null_valid_identifier.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT `null` FROM remote('127.0.0.2', view(SELECT 1 AS `null`));
SELECT `NULL` FROM remote('127.0.0.2', view(SELECT 1 AS `NULL`));
SELECT `nULl`, null FROM remote('127.0.0.2', view(SELECT 1 AS `nULl`));
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>01942_snowflakeToDateTime.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- -- Error cases
SELECT snowflakeToDateTime();  -- {serverError NUMBER_OF_ARGUMENTS_DOESNT_MATCH}
SELECT snowflakeToDateTime64();  -- {serverError NUMBER_OF_ARGUMENTS_DOESNT_MATCH}

SELECT snowflakeToDateTime('abc');  -- {serverError ILLEGAL_TYPE_OF_ARGUMENT}
SELECT snowflakeToDateTime64('abc');  -- {serverError ILLEGAL_TYPE_OF_ARGUMENT}

SELECT snowflakeToDateTime('abc', 123);  -- {serverError ILLEGAL_TYPE_OF_ARGUMENT}
SELECT snowflakeToDateTime64('abc', 123);  -- {serverError ILLEGAL_TYPE_OF_ARGUMENT}

SELECT 'const column';
WITH
	CAST(1426860704886947840 AS Int64) AS i64,
	'UTC' AS tz
SELECT
	tz,
	i64,
	snowflakeToDateTime(i64, tz) as dt,
	toTypeName(dt),
	snowflakeToDateTime64(i64, tz) as dt64,
	toTypeName(dt64);

WITH
	CAST(1426860704886947840 AS Int64) AS i64,
	'Asia/Shanghai' AS tz
SELECT
	tz,
	i64,
	snowflakeToDateTime(i64, tz) as dt,
	toTypeName(dt),
	snowflakeToDateTime64(i64, tz) as dt64,
	toTypeName(dt64);


DROP TABLE IF EXISTS tab;
CREATE TABLE tab(val Int64, tz String) engine=Log;
INSERT INTO tab VALUES (42, 'Asia/Singapore');

SELECT 1 FROM tab WHERE snowflakeToDateTime(42::Int64, tz) != now() SETTINGS allow_nonconst_timezone_arguments = 1;
SELECT 1 FROM tab WHERE snowflakeToDateTime64(42::Int64, tz) != now() SETTINGS allow_nonconst_timezone_arguments = 1;

DROP TABLE tab;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02012_zookeeper_changed_enum_type_incompatible.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: zookeeper, no-replicated-database
-- Tag no-replicated-database: Fails due to additional replicas or shards

drop table if exists enum_alter_issue;
create table enum_alter_issue (a Enum16('one' = 1, 'two' = 2), b Int)
engine = ReplicatedMergeTree('/clickhouse/tables/{database}/test_02012/enum_alter_issue', 'r2')
ORDER BY b;

insert into enum_alter_issue values ('one', 1), ('two', 1);
alter table enum_alter_issue detach partition id 'all';
alter table enum_alter_issue modify column a Enum8('one' = 1, 'two' = 2, 'three' = 3);
insert into enum_alter_issue values ('one', 1), ('two', 1);

alter table enum_alter_issue attach partition id 'all';
select * from enum_alter_issue;
drop table enum_alter_issue;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02024_compile_expressions_with_short_circuit_evaluation.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- { echo }
select 1+number+multiIf(number == 1, cityHash64(number), number) from numbers(1) settings compile_expressions=1, min_count_to_compile_expression=0;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02030_tuple_filter.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET allow_experimental_analyzer = 1;

DROP TABLE IF EXISTS test_tuple_filter;

CREATE TABLE test_tuple_filter (id UInt32, value String, log_date Date) Engine=MergeTree() ORDER BY id PARTITION BY log_date SETTINGS index_granularity = 3, index_granularity_bytes = '10Mi';

INSERT INTO test_tuple_filter VALUES (1,'A','2021-01-01'),(2,'B','2021-01-01'),(3,'C','2021-01-01'),(4,'D','2021-01-02'),(5,'E','2021-01-02');

SET force_primary_key = 1;
SET optimize_move_to_prewhere = 1;

SELECT * FROM test_tuple_filter WHERE (id, value) = (1, 'A');
SELECT * FROM test_tuple_filter WHERE (1, 'A') = (id, value);
SELECT * FROM test_tuple_filter WHERE (id, value) = (1, 'A') AND (id, log_date) = (1, '2021-01-01');
SELECT * FROM test_tuple_filter WHERE ((id, value), id * 2) = ((1, 'A'), 2);
SELECT * FROM test_tuple_filter WHERE ((id, value), log_date) = ((1, 'A'), '2021-01-01');

-- not supported functions (concat) do not lost
SELECT * FROM test_tuple_filter WHERE (id, value, value||'foo') = ('1', 'A', 'A');

SELECT * FROM test_tuple_filter WHERE (1, (1, (1, (1, (id, value))))) = (1, (1, (1, (1, (1, 'A')))));

SELECT * FROM test_tuple_filter WHERE (1, value) = (id, 'A');
SELECT * FROM test_tuple_filter WHERE (1, (1, (1, (1, tuple(id))))) = (1, (1, (1, (1, tuple(1)))));
SELECT * FROM test_tuple_filter WHERE ((id, value), tuple(log_date)) = ((1, 'A'), tuple('2021-01-01'));

SET force_index_by_date = 1;
SET force_primary_key = 0;
SELECT * FROM test_tuple_filter WHERE (log_date, value) = ('2021-01-01', 'A');

SET force_index_by_date = 0;
SET force_primary_key = 0;

SELECT * FROM test_tuple_filter WHERE (1, value) = (id, 'A');
SELECT * FROM test_tuple_filter WHERE tuple(id) = tuple(1);
SELECT * FROM test_tuple_filter WHERE (id, (id, id) = (1, NULL)) == (NULL, NULL);

SELECT * FROM test_tuple_filter WHERE (log_date, value) = tuple('2021-01-01'); -- { serverError 43 }
SELECT * FROM test_tuple_filter WHERE (id, value) = tuple(1); -- { serverError 43 }
SELECT * FROM test_tuple_filter WHERE tuple(id, value) = tuple(value, id); -- { serverError 386 }
SELECT * FROM test_tuple_filter WHERE equals((id, value)); -- { serverError 42 }

DROP TABLE IF EXISTS test_tuple_filter;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02067_lost_part_s3.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest

DROP TABLE IF EXISTS partslost_0;
DROP TABLE IF EXISTS partslost_1;
DROP TABLE IF EXISTS partslost_2;

CREATE TABLE partslost_0 (x String) ENGINE=ReplicatedMergeTree('/clickhouse/table/{database}_02067_lost/partslost', '0') ORDER BY tuple()
    SETTINGS min_rows_for_wide_part = 0, min_bytes_for_wide_part = 0, old_parts_lifetime = 1,
    cleanup_delay_period = 1, cleanup_delay_period_random_add = 1, cleanup_thread_preferred_points_per_iteration=0,
    index_granularity = 8192, index_granularity_bytes = '10Mi';

CREATE TABLE partslost_1 (x String) ENGINE=ReplicatedMergeTree('/clickhouse/table/{database}_02067_lost/partslost', '1') ORDER BY tuple()
    SETTINGS min_rows_for_wide_part = 0, min_bytes_for_wide_part = 0, old_parts_lifetime = 1,
    cleanup_delay_period = 1, cleanup_delay_period_random_add = 1, cleanup_thread_preferred_points_per_iteration=0,
    index_granularity = 8192, index_granularity_bytes = '10Mi';

CREATE TABLE partslost_2 (x String) ENGINE=ReplicatedMergeTree('/clickhouse/table/{database}_02067_lost/partslost', '2') ORDER BY tuple()
    SETTINGS min_rows_for_wide_part = 0, min_bytes_for_wide_part = 0, old_parts_lifetime = 1,
    cleanup_delay_period = 1, cleanup_delay_period_random_add = 1, cleanup_thread_preferred_points_per_iteration=0,
    index_granularity = 8192, index_granularity_bytes = '10Mi';


INSERT INTO partslost_0 SELECT toString(number) AS x from system.numbers LIMIT 10000;

ALTER TABLE partslost_0 ADD INDEX idx x TYPE tokenbf_v1(285000, 3, 12345) GRANULARITY 3;

SET mutations_sync = 2;

ALTER TABLE partslost_0 MATERIALIZE INDEX idx;

-- In worst case doesn't check anything, but it's not flaky
select sleep(3) FORMAT Null;
select sleep(3) FORMAT Null;
select sleep(3) FORMAT Null;
select sleep(3) FORMAT Null;

ALTER TABLE partslost_0 DROP INDEX idx;

select count() from partslost_0;
select count() from partslost_1;
select count() from partslost_2;

DROP TABLE IF EXISTS partslost_0;
DROP TABLE IF EXISTS partslost_1;
DROP TABLE IF EXISTS partslost_2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02155_read_in_order_max_rows_to_read.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET merge_tree_read_split_ranges_into_intersecting_and_non_intersecting_injection_probability = 0.0;

DROP TABLE IF EXISTS t_max_rows_to_read;

CREATE TABLE t_max_rows_to_read (a UInt64)
ENGINE = MergeTree ORDER BY a
SETTINGS index_granularity = 4, index_granularity_bytes = '10Mi';

INSERT INTO t_max_rows_to_read SELECT number FROM numbers(100);

SET max_threads = 1;
SET optimize_read_in_order = 1;

SELECT a FROM t_max_rows_to_read WHERE a = 10 SETTINGS max_rows_to_read = 4;

SELECT a FROM t_max_rows_to_read ORDER BY a LIMIT 5 SETTINGS max_rows_to_read = 12;

SELECT a FROM t_max_rows_to_read WHERE a = 10 OR a = 20 SETTINGS max_rows_to_read = 12;

SELECT a FROM t_max_rows_to_read ORDER BY a LIMIT 20 FORMAT Null SETTINGS max_rows_to_read = 12; -- { serverError 158 }
SELECT a FROM t_max_rows_to_read WHERE a > 10 ORDER BY a LIMIT 5 FORMAT Null SETTINGS max_rows_to_read = 12; -- { serverError 158 }
SELECT a FROM t_max_rows_to_read WHERE a = 10 OR a = 20 FORMAT Null SETTINGS max_rows_to_read = 4; -- { serverError 158 }

DROP TABLE t_max_rows_to_read;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02207_ttl_move_if_exists.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t_ttl_move_if_exists;

CREATE TABLE t_ttl_move_if_exists (d DateTime, a UInt32)
ENGINE = MergeTree ORDER BY tuple()
TTL d TO DISK IF EXISTS 'non_existing_disk';

SHOW CREATE TABLE t_ttl_move_if_exists;

DROP TABLE IF EXISTS t_ttl_move_if_exists;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02210_toColumnTypeName_toLowCardinality_const.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT toColumnTypeName(toLowCardinality(1));
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02246_flatten_tuple.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest

DROP TABLE IF EXISTS t_flatten_tuple;
DROP TABLE IF EXISTS t_flatten_object;

SET flatten_nested = 0;

CREATE TABLE t_flatten_tuple(t Tuple(t1 Nested(a UInt32, s String), b UInt32, t2 Tuple(k String, v UInt32))) ENGINE = Memory;

INSERT INTO t_flatten_tuple VALUES (([(1, 'a'), (2, 'b')], 3, ('c', 4)));

SELECT flattenTuple(t) AS ft, toTypeName(ft) FROM t_flatten_tuple;

SET allow_experimental_object_type = 1;
CREATE TABLE t_flatten_object(data JSON) ENGINE = Memory;

INSERT INTO t_flatten_object VALUES ('{"id": 1, "obj": {"k1": 1, "k2": {"k3": 2, "k4": [{"k5": 3}, {"k5": 4}]}}, "s": "foo"}');
INSERT INTO t_flatten_object VALUES ('{"id": 2, "obj": {"k2": {"k3": "str", "k4": [{"k6": 55}]}, "some": 42}, "s": "bar"}');

SELECT toTypeName(data), toTypeName(flattenTuple(data)) FROM t_flatten_object LIMIT 1;
SELECT untuple(flattenTuple(data)) FROM t_flatten_object ORDER BY data.id;

DROP TABLE IF EXISTS t_flatten_tuple;
DROP TABLE IF EXISTS t_flatten_object;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02271_replace_partition_many_tables.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-fasttest

DROP TABLE IF EXISTS replace_partition_source;
DROP TABLE IF EXISTS replace_partition_dest1;
DROP TABLE IF EXISTS replace_partition_dest1_2;
DROP TABLE IF EXISTS replace_partition_dest2;
DROP TABLE IF EXISTS replace_partition_dest2_2;

CREATE TABLE replace_partition_source
(
    key UInt64
)
ENGINE = ReplicatedMergeTree('/test/02271_replace_partition_many/{database}/source', '1')
PARTITION BY key
ORDER BY tuple();

INSERT INTO replace_partition_source VALUES (1);

CREATE TABLE replace_partition_dest1
(
    key UInt64
)
ENGINE = ReplicatedMergeTree('/test/02271_replace_partition_many/{database}/dest1', '1')
PARTITION BY key
ORDER BY tuple();

CREATE TABLE replace_partition_dest1_2
(
    key UInt64
)
ENGINE = ReplicatedMergeTree('/test/02271_replace_partition_many/{database}/dest1', '2')
PARTITION BY key
ORDER BY tuple();


CREATE TABLE replace_partition_dest2
(
    key UInt64
)
ENGINE = ReplicatedMergeTree('/test/02271_replace_partition_many/{database}/dest2', '1')
PARTITION BY key
ORDER BY tuple();

CREATE TABLE replace_partition_dest2_2
(
    key UInt64
)
ENGINE = ReplicatedMergeTree('/test/02271_replace_partition_many/{database}/dest2', '2')
PARTITION BY key
ORDER BY tuple();


ALTER TABLE replace_partition_dest1 REPLACE PARTITION 1 FROM replace_partition_source;
ALTER TABLE replace_partition_dest2 REPLACE PARTITION 1 FROM replace_partition_source;

OPTIMIZE TABLE replace_partition_source FINAL;

SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;

OPTIMIZE TABLE replace_partition_dest1_2 FINAL;
OPTIMIZE TABLE replace_partition_dest2_2 FINAL;

SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;
SELECT sleep(3) FORMAT Null;

SELECT * FROM replace_partition_source;
SELECT * FROM replace_partition_dest1;
SELECT * FROM replace_partition_dest2;
SELECT * FROM replace_partition_dest1_2;
SELECT * FROM replace_partition_dest2_2;


--DROP TABLE IF EXISTS replace_partition_source;
--DROP TABLE IF EXISTS replace_partition_dest1;
--DROP TABLE IF EXISTS replace_partition_dest1_2;
--DROP TABLE IF EXISTS replace_partition_dest2;
--DROP TABLE IF EXISTS replace_partition_dest2_2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02276_full_sort_join_unsupported.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;

CREATE TABLE t1 (key UInt32, val UInt32) ENGINE = Memory;
INSERT INTO t1 VALUES (1, 1);

CREATE TABLE t2 (key UInt32, val UInt32) ENGINE = Memory;
INSERT INTO t2 VALUES (1, 2);

SET join_algorithm = 'full_sorting_merge';

SELECT * FROM t1 JOIN t2 ON t1.key = t2.key AND t2.key > 0; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 JOIN t2 ON t1.key = t2.key AND t1.key > 0; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 JOIN t2 ON t1.key = t2.key OR t1.val = t2.key; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 ANTI JOIN t2 ON t1.key = t2.key; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 SEMI JOIN t2 ON t1.key = t2.key; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 ASOF JOIN t2 ON t1.key = t2.key AND t1.val > t2.val; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 ANY JOIN t2 ON t1.key = t2.key SETTINGS any_join_distinct_right_table_keys = 1; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 JOIN t2 USING (key) SETTINGS join_use_nulls = 1; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM ( SELECT key, sum(val) AS val FROM t1 GROUP BY key WITH TOTALS ) as t1
JOIN ( SELECT key, sum(val) AS val FROM t2 GROUP BY key WITH TOTALS ) as t2 ON t1.key = t2.key; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM t1 JOIN ( SELECT key, sum(val) AS val FROM t2 GROUP BY key WITH TOTALS ) as t2 ON t1.key = t2.key; -- { serverError NOT_IMPLEMENTED }

SELECT * FROM ( SELECT key, sum(val) AS val FROM t1 GROUP BY key WITH TOTALS ) as t1 JOIN t2 ON t1.key = t2.key; -- { serverError NOT_IMPLEMENTED }

DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02291_dictionary_scalar_subquery_reload.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS test_dictionary_source_table;
CREATE TABLE test_dictionary_source_table
(
    id UInt64,
    value String
) ENGINE = TinyLog;

DROP TABLE IF EXISTS test_dictionary_view;
CREATE VIEW test_dictionary_view
(
    id UInt64,
    value String
) AS SELECT id, value FROM test_dictionary_source_table WHERE id = (SELECT max(id) FROM test_dictionary_source_table);

INSERT INTO test_dictionary_source_table VALUES (1, '1'), (2, '2'), (3, '3');

DROP DICTIONARY IF EXISTS test_dictionary;
CREATE DICTIONARY test_dictionary
(
    id UInt64,
    value String
)
PRIMARY KEY id
SOURCE(CLICKHOUSE(TABLE 'test_dictionary_view'))
LIFETIME(MIN 0 MAX 1)
LAYOUT(FLAT());

SELECT * FROM test_dictionary;

INSERT INTO test_dictionary_source_table VALUES (4, '4');
SYSTEM RELOAD DICTIONARY test_dictionary;

SELECT * FROM test_dictionary;

DROP DICTIONARY test_dictionary;
DROP VIEW test_dictionary_view;
DROP TABLE test_dictionary_source_table;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02346_additional_filters.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: distributed
drop table if exists table_1;
drop table if exists table_2;
drop table if exists v_numbers;
drop table if exists mv_table;

create table table_1 (x UInt32, y String) engine = MergeTree order by x;
insert into table_1 values (1, 'a'), (2, 'bb'), (3, 'ccc'), (4, 'dddd');

CREATE TABLE distr_table (x UInt32, y String) ENGINE = Distributed(test_cluster_two_shards, currentDatabase(), 'table_1');

-- { echoOn }

select * from table_1;
select * from table_1 settings additional_table_filters={'table_1' : 'x != 2'};
select * from table_1 settings additional_table_filters={'table_1' : 'x != 2 and x != 3'};
select x from table_1 settings additional_table_filters={'table_1' : 'x != 2'};
select y from table_1 settings additional_table_filters={'table_1' : 'x != 2'};
select * from table_1 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select * from table_1 prewhere x != 4 settings additional_table_filters={'table_1' : 'x != 2'};
select * from table_1 prewhere x != 4 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 prewhere x != 4 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 prewhere x != 4 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select y from table_1 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select y from table_1 prewhere x != 4 settings additional_table_filters={'table_1' : 'x != 2'};
select y from table_1 prewhere x != 4 where x != 3 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 where x != 2 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 prewhere x != 2 settings additional_table_filters={'table_1' : 'x != 2'};
select x from table_1 prewhere x != 2 where x != 2 settings additional_table_filters={'table_1' : 'x != 2'};

select * from remote('127.0.0.{1,2}', system.one) settings additional_table_filters={'system.one' : 'dummy = 0'};
select * from remote('127.0.0.{1,2}', system.one) settings additional_table_filters={'system.one' : 'dummy != 0'};

select * from distr_table settings additional_table_filters={'distr_table' : 'x = 2'};
select * from distr_table settings additional_table_filters={'distr_table' : 'x != 2 and x != 3'};

select * from system.numbers limit 5;
select * from system.numbers as t limit 5 settings additional_table_filters={'t' : 'number % 2 != 0'};
select * from system.numbers limit 5 settings additional_table_filters={'system.numbers' : 'number != 3'};
select * from system.numbers limit 5 settings additional_table_filters={'system.numbers':'number != 3','table_1':'x!=2'};
select * from (select number from system.numbers limit 5 union all select x from table_1) order by number settings additional_table_filters={'system.numbers':'number != 3','table_1':'x!=2'};
select number, x, y from (select number from system.numbers limit 5) f any left join (select x, y from table_1) s on f.number = s.x settings additional_table_filters={'system.numbers' : 'number != 3', 'table_1' : 'x != 2'};
select b + 1 as c from (select a + 1 as b from (select x + 1 as a from table_1)) settings additional_table_filters={'table_1' : 'x != 2 and x != 3'};

-- { echoOff }

create view v_numbers as select number + 1 as x from system.numbers limit 5;

-- { echoOn }
select * from v_numbers;
select * from v_numbers settings additional_table_filters={'system.numbers' : 'number != 3'};
select * from v_numbers settings additional_table_filters={'v_numbers' : 'x != 3'};
select * from v_numbers settings additional_table_filters={'system.numbers' : 'number != 3', 'v_numbers' : 'x != 3'};

-- { echoOff }

create table table_2 (x UInt32, y String) engine = MergeTree order by x;
insert into table_2 values (4, 'dddd'), (5, 'eeeee'), (6, 'ffffff'), (7, 'ggggggg');

create materialized view mv_table to table_2 (x UInt32, y String) as select * from table_1;

-- additional filter for inner tables for Materialized View does not work because it does not create internal interpreter
-- probably it is expected
-- { echoOn }
select * from mv_table;
select * from mv_table settings additional_table_filters={'mv_table' : 'x != 5'};
select * from mv_table settings additional_table_filters={'table_1' : 'x != 5'};
select * from mv_table settings additional_table_filters={'table_2' : 'x != 5'};

-- { echoOff }

create table m_table (x UInt32, y String) engine = Merge(currentDatabase(), '^table_');

-- additional filter for inner tables for Merge does not work because it does not create internal interpreter
-- probably it is expected
-- { echoOn }
select * from m_table order by x;
select * from m_table order by x settings additional_table_filters={'table_1' : 'x != 2'};
select * from m_table order by x  settings additional_table_filters={'table_2' : 'x != 5'};
select * from m_table order by x  settings additional_table_filters={'table_1' : 'x != 2', 'table_2' : 'x != 5'};
select * from m_table order by x  settings additional_table_filters={'table_1' : 'x != 4'};
select * from m_table order by x  settings additional_table_filters={'table_2' : 'x != 4'};
select * from m_table order by x  settings additional_table_filters={'table_1' : 'x != 4', 'table_2' : 'x != 4'};
select * from m_table order by x  settings additional_table_filters={'m_table' : 'x != 4'};
select * from m_table order by x  settings additional_table_filters={'m_table' : 'x != 4', 'table_1' : 'x != 2', 'table_2' : 'x != 5'};

-- additional_result_filter

select * from table_1 settings additional_result_filter='x != 2';
select *, x != 2 from table_1 settings additional_result_filter='x != 2';
select * from table_1 where x != 1 settings additional_result_filter='x != 2';
select * from table_1 where x != 1 settings additional_result_filter='x != 2 and x != 3';
select * from table_1 prewhere x != 3 where x != 1 settings additional_result_filter='x != 2';

select * from table_1 limit 3 settings additional_result_filter='x != 2';

select x + 1 from table_1 settings additional_result_filter='`plus(x, 1)` != 2';

select * from (select x + 1 as a, y from table_1 union all select x as a, y from table_1) order by a, y settings additional_result_filter='a = 3';
select * from (select x + 1 as a, y from table_1 union all select x as a, y from table_1) order by a, y settings additional_result_filter='a != 3';
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02346_additional_filters_distr.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-parallel, distributed

create database if not exists shard_0;
create database if not exists shard_1;

drop table if exists dist_02346;
drop table if exists shard_0.data_02346;
drop table if exists shard_1.data_02346;

create table shard_0.data_02346 (x UInt32, y String) engine = MergeTree order by x settings index_granularity = 2;
insert into shard_0.data_02346 values (1, 'a'), (2, 'bb'), (3, 'ccc'), (4, 'dddd');

create table shard_1.data_02346 (x UInt32, y String) engine = MergeTree order by x settings index_granularity = 2;
insert into shard_1.data_02346 values (5, 'a'), (6, 'bb'), (7, 'ccc'), (8, 'dddd');

create table dist_02346 (x UInt32, y String) engine=Distributed('test_cluster_two_shards_different_databases', /* default_database= */ '', data_02346);

set max_rows_to_read=4;

select * from dist_02346 order by x settings additional_table_filters={'dist_02346' : 'x > 3 and x < 7'};
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02347_rank_corr_nan.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT rankCorr(number, nan) FROM numbers(10);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02347_rank_corr_size_overflow.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT round(rankCorr(number, -number)) FROM numbers(5000000);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02366_asof_optimize_predicate_bug_37813.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (c1 Int32, c2 Int32) ENGINE MergeTree ORDER BY c1;
INSERT INTO t1 (c1, c2) VALUES (1, 10), (1, 20), (1, 30);

DROP TABLE IF EXISTS t2;
CREATE TABLE t2 (c1 Int32, c2 Int32, c3 String) ENGINE MergeTree ORDER BY (c1, c2, c3);
INSERT INTO t2 (c1, c2, c3) VALUES (1, 5, 'a'), (1, 15, 'b'), (1, 25, 'c');

SET enable_optimize_predicate_expression = 1;
WITH
  v1 AS (SELECT t1.c2, t2.c2, t2.c3 FROM t1 ASOF JOIN t2 USING (c1, c2))
  SELECT count() FROM v1 WHERE c3 = 'b';

SET enable_optimize_predicate_expression = 0;
WITH
  v1 AS (SELECT t1.c2, t2.c2, t2.c3 FROM t1 ASOF JOIN t2 USING (c1, c2))
  SELECT count() FROM v1 WHERE c3 = 'b';
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02366_kql_distinct.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS Customers;
CREATE TABLE Customers
(    
    FirstName Nullable(String),
    LastName String, 
    Occupation String,
    Education String,
    Age Nullable(UInt8)
) ENGINE = Memory;

INSERT INTO Customers VALUES ('Theodore','Diaz','Skilled Manual','Bachelors',28), ('Stephanie','Cox','Management abcd defg','Bachelors',33),('Peter','Nara','Skilled Manual','Graduate Degree',26),('Latoya','Shen','Professional','Graduate Degree',25),('Apple','','Skilled Manual','Bachelors',28),(NULL,'why','Professional','Partial College',38);

set dialect = 'kusto';

print '--  distinct * --';
Customers | distinct *;

print '--  distinct one column --';
Customers | distinct Occupation;

print '--  distinct two column --';
Customers | distinct Occupation, Education;

print '--  distinct with where --';
Customers where Age <30 | distinct Occupation, Education;

print '--  distinct with where, order --';
Customers |where Age <30 | order by Age| distinct Occupation, Education;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02377_majority_insert_quorum_zookeeper_long.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: long, zookeeper, no-replicated-database

-- no-replicated-database:
--   The number of replicas is doubled, so `SYSTEM STOP FETCHES` stop not enough replicas.

SET insert_quorum_parallel = false;

SET select_sequential_consistency = 1;

DROP TABLE IF EXISTS quorum1;
DROP TABLE IF EXISTS quorum2;
DROP TABLE IF EXISTS quorum3;

CREATE TABLE quorum1(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_02377/quorum', '1') ORDER BY x PARTITION BY y;
CREATE TABLE quorum2(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_02377/quorum', '2') ORDER BY x PARTITION BY y;

-- insert_quorum = n/2 + 1 , so insert will be written to both replica
SET insert_quorum = 'auto';
SET insert_keeper_fault_injection_probability=0;

INSERT INTO quorum1 VALUES (1, '2018-11-15');
INSERT INTO quorum1 VALUES (2, '2018-11-15');
INSERT INTO quorum1 VALUES (3, '2018-12-16');

SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;

DROP TABLE quorum1;
DROP TABLE quorum2;

-- Create 3 replicas and stop sync 2 replicas
CREATE TABLE quorum1(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_02377/quorum1', '1') ORDER BY x PARTITION BY y;
CREATE TABLE quorum2(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_02377/quorum1', '2') ORDER BY x PARTITION BY y;
CREATE TABLE quorum3(x UInt32, y Date) ENGINE ReplicatedMergeTree('/clickhouse/tables/{database}/test_02377/quorum1', '3') ORDER BY x PARTITION BY y;

-- Insert should be successful
-- stop replica 3
SYSTEM STOP FETCHES quorum3;
INSERT INTO quorum1 VALUES (1, '2018-11-15');
SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;
SELECT x FROM quorum3 ORDER BY x; -- {serverError REPLICA_IS_NOT_IN_QUORUM}

-- Sync replica 3
SYSTEM START FETCHES quorum3;
SYSTEM SYNC REPLICA quorum3;
SELECT x FROM quorum3 ORDER BY x;

-- Stop 2 replicas , so insert wont be successful
SYSTEM STOP FETCHES quorum2;
SYSTEM STOP FETCHES quorum3;
SET insert_quorum_timeout = 5000;
INSERT INTO quorum1 VALUES (2, '2018-11-15'); -- { serverError UNKNOWN_STATUS_OF_INSERT }
SELECT x FROM quorum1 ORDER BY x;
SELECT x FROM quorum2 ORDER BY x;
SELECT x FROM quorum3 ORDER BY x;

-- Sync replica 2 and 3
SYSTEM START FETCHES quorum2;
SYSTEM SYNC REPLICA quorum2;
SYSTEM START FETCHES quorum3;
SYSTEM SYNC REPLICA quorum3;

SET insert_quorum_timeout = 600000; -- set default value back
INSERT INTO quorum1 VALUES (3, '2018-11-15');
SELECT x FROM quorum1 ORDER BY x;
SYSTEM SYNC REPLICA quorum2;
SYSTEM SYNC REPLICA quorum3;
SELECT x FROM quorum2 ORDER BY x;
SELECT x FROM quorum3 ORDER BY x;

DROP TABLE quorum1;
DROP TABLE quorum2;
DROP TABLE quorum3;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02418_keeper_map_keys_limit.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-ordinary-database, no-fasttest

DROP TABLE IF EXISTS 02418_test SYNC;

CREATE TABLE 02418_test (key UInt64, value Float64) Engine=KeeperMap('/' || currentDatabase() || '/test2418', 3) PRIMARY KEY(key);

INSERT INTO 02418_test VALUES (1, 1.1), (2, 2.2);
SELECT count() FROM 02418_test;

INSERT INTO 02418_test VALUES (3, 3.3), (4, 4.4); -- { serverError LIMIT_EXCEEDED }

INSERT INTO 02418_test VALUES (1, 2.1), (2, 3.2), (3, 3.3);
SELECT count() FROM 02418_test;

CREATE TABLE 02418_test_another (key UInt64, value Float64) Engine=KeeperMap('/' || currentDatabase() || '/test2418', 4) PRIMARY KEY(key);
INSERT INTO 02418_test VALUES (4, 4.4); -- { serverError LIMIT_EXCEEDED }
INSERT INTO 02418_test_another VALUES (4, 4.4);

SELECT count() FROM 02418_test;
SELECT count() FROM 02418_test_another;

DELETE FROM 02418_test WHERE key <= 2;
INSERT INTO 02418_test VALUES (1, 1.1);
INSERT INTO 02418_test VALUES (2, 1.1); -- { serverError LIMIT_EXCEEDED }

SELECT count() FROM 02418_test;
SELECT count() FROM 02418_test_another;

DROP TABLE 02418_test SYNC;
DROP TABLE 02418_test_another SYNC;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02428_partial_sort_optimization_bug.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>create table partial_sort_opt_bug (x UInt64) engine = MergeTree order by tuple() settings index_granularity = 1000;

insert into partial_sort_opt_bug select number + 100000 from numbers(4000);

insert into partial_sort_opt_bug select number from numbers(1000);
insert into partial_sort_opt_bug select number + 200000 from numbers(3000);
insert into partial_sort_opt_bug select number + 1000 from numbers(4000);
optimize table partial_sort_opt_bug final;

select x from partial_sort_opt_bug order by x limit 2000 settings max_block_size = 4000;

</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02494_query_cache_query_log.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-parallel
-- Tag no-parallel: Messes with internal cache

SYSTEM DROP QUERY CACHE;

-- DROP TABLE system.query_log; -- debugging



SELECT '-- Run a query with query cache not enabled';
SELECT 124437993;

SYSTEM FLUSH LOGS;

-- Field 'query_cache_usage' should be 'None'
SELECT type, query, query_cache_usage
FROM system.query_log
WHERE current_database = currentDatabase()
    AND query = 'SELECT 124437993;'
    AND type = 'QueryFinish'
ORDER BY type, query_cache_usage;



SELECT '-- Run a query with query cache enabled';
SELECT 124437994 SETTINGS use_query_cache = 1;

SYSTEM FLUSH LOGS;

-- Field 'query_cache_usage' should be 'Write'
SELECT type, query, query_cache_usage
FROM system.query_log
WHERE current_database = currentDatabase()
    AND query = 'SELECT 124437994 SETTINGS use_query_cache = 1;'
    AND type = 'QueryFinish'
ORDER BY type, query_cache_usage;



SELECT '-- Run the same query with query cache enabled';
SELECT 124437994 SETTINGS use_query_cache = 1;

SYSTEM FLUSH LOGS;

-- Field 'query_cache_usage' should be 'Read'
SELECT type, query, query_cache_usage
FROM system.query_log
WHERE current_database = currentDatabase()
    AND query = 'SELECT 124437994 SETTINGS use_query_cache = 1;'
    AND type = 'QueryFinish'
ORDER BY type, query_cache_usage;



SELECT '-- Throw exception with query cache enabled';
SELECT 124437995, throwIf(1) SETTINGS use_query_cache = 1; -- { serverError FUNCTION_THROW_IF_VALUE_IS_NON_ZERO }

SYSTEM FLUSH LOGS;

-- Field 'query_cache_usage' should be 'None'
SELECT query, query_cache_usage
FROM system.query_log
WHERE current_database = currentDatabase()
    AND query = 'SELECT 124437995, throwIf(1) SETTINGS use_query_cache = 1;'
    AND type = 'ExceptionWhileProcessing';

SYSTEM DROP QUERY CACHE;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02504_parse_datetime_best_effort_calebeaires.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>CREATE TEMPORARY TABLE my_table (col_date Date, col_date32 Date32, col_datetime DateTime('UTC'), col_datetime32 DateTime32('UTC'), col_datetime64 DateTime64);
insert into `my_table` (`col_date`, `col_date32`, `col_datetime`, `col_datetime32`, `col_datetime64`) values (parseDateTime64BestEffort('1969-01-01'), '1969-01-01', parseDateTime64BestEffort('1969-01-01 10:42:00'), parseDateTime64BestEffort('1969-01-01 10:42:00'), parseDateTime64BestEffort('1969-01-01 10:42:00'));

-- The values for Date32 and DateTime64 will be year 1969, while the values of Date, DateTime will contain a value affected by implementation-defined overflow and can be arbitrary.
SELECT toYear(col_date), col_date32, toYear(col_datetime), toYear(col_datetime32), col_datetime64 FROM my_table;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02507_to_unix_timestamp_overflow.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT toUnixTimestamp(toDateTime64('1928-12-31 12:12:12.123', 3, 'UTC')); -- { serverError DECIMAL_OVERFLOW }
SELECT toInt64(toDateTime64('1928-12-31 12:12:12.123', 3, 'UTC'));
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02515_tuple_lambda_parsing.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>explain ast select tuple(a) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select tuple(a, b) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select (tuple(a)) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select (f(a)) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select (a::UInt64) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select (1) -> f(a); -- { clientError SYNTAX_ERROR }
explain ast select (1::UInt64) -> f(a); -- { clientError SYNTAX_ERROR }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02516_projections_and_context.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS test1__fuzz_37;
CREATE TABLE test1__fuzz_37 (`i` Date) ENGINE = MergeTree ORDER BY i;
insert into test1__fuzz_37 values ('2020-10-10');
set allow_experimental_analyzer = 0;
SELECT count() FROM test1__fuzz_37 GROUP BY dictHas(NULL, (dictHas(NULL, (('', materialize(NULL)), materialize(NULL))), 'KeyKey')), dictHas('test_dictionary', tuple(materialize('Ke\0'))), tuple(dictHas(NULL, (tuple('Ke\0Ke\0Ke\0Ke\0Ke\0Ke\0\0\0\0Ke\0'), materialize(NULL)))), 'test_dicti\0nary', (('', materialize(NULL)), dictHas(NULL, (dictHas(NULL, tuple(materialize(NULL))), 'KeyKeyKeyKeyKeyKeyKeyKey')), materialize(NULL)); -- { serverError BAD_ARGUMENTS }
SELECT count() FROM test1__fuzz_37 GROUP BY dictHas('non_existing_dictionary', materialize('a')); -- { serverError BAD_ARGUMENTS }
set allow_experimental_analyzer = 1;
SELECT count() FROM test1__fuzz_37 GROUP BY dictHas(NULL, (dictHas(NULL, (('', materialize(NULL)), materialize(NULL))), 'KeyKey')), dictHas('test_dictionary', tuple(materialize('Ke\0'))), tuple(dictHas(NULL, (tuple('Ke\0Ke\0Ke\0Ke\0Ke\0Ke\0\0\0\0Ke\0'), materialize(NULL)))), 'test_dicti\0nary', (('', materialize(NULL)), dictHas(NULL, (dictHas(NULL, tuple(materialize(NULL))), 'KeyKeyKeyKeyKeyKeyKeyKey')), materialize(NULL)); -- { serverError BAD_ARGUMENTS }
SELECT count() FROM test1__fuzz_37 GROUP BY dictHas('non_existing_dictionary', materialize('a')); -- { serverError BAD_ARGUMENTS }
DROP TABLE test1__fuzz_37;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02521_lightweight_delete_and_ttl.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS lwd_test_02521;

CREATE TABLE lwd_test_02521 (id UInt64, value String, event_time DateTime)
ENGINE MergeTree()
ORDER BY id
SETTINGS min_bytes_for_wide_part = 0, index_granularity = 8192, index_granularity_bytes = '10Mi';

INSERT INTO lwd_test_02521 SELECT number, randomString(10), now() - INTERVAL 2 MONTH FROM numbers(50000);
INSERT INTO lwd_test_02521 SELECT number, randomString(10), now() FROM numbers(50000);

OPTIMIZE TABLE lwd_test_02521 FINAL SETTINGS mutations_sync = 1;

SET mutations_sync=1;

-- { echoOn }
SELECT 'Rows in parts', SUM(rows) FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_test_02521' AND active;
SELECT 'Count', count() FROM lwd_test_02521;


DELETE FROM lwd_test_02521 WHERE id < 25000;

SELECT 'Rows in parts', SUM(rows) FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_test_02521' AND active;
SELECT 'Count', count() FROM lwd_test_02521;


ALTER TABLE lwd_test_02521 MODIFY TTL event_time + INTERVAL 1 MONTH SETTINGS mutations_sync = 1;

SELECT 'Rows in parts', SUM(rows) FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_test_02521' AND active;
SELECT 'Count', count() FROM lwd_test_02521;


ALTER TABLE lwd_test_02521 DELETE WHERE id >= 40000 SETTINGS mutations_sync = 1;

SELECT 'Rows in parts', SUM(rows) FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_test_02521' AND active;
SELECT 'Count', count() FROM lwd_test_02521;


OPTIMIZE TABLE lwd_test_02521 FINAL SETTINGS mutations_sync = 1;

SELECT 'Rows in parts', SUM(rows) FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_test_02521' AND active;
SELECT 'Count', count() FROM lwd_test_02521;

-- { echoOff }

DROP TABLE lwd_test_02521;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02539_vertical_merge_compact_parts.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t_compact_vertical_merge;

CREATE TABLE t_compact_vertical_merge (id UInt64, s LowCardinality(String), arr Array(UInt64))
ENGINE MergeTree ORDER BY id
SETTINGS
    index_granularity = 16,
    min_bytes_for_wide_part = 0,
    min_rows_for_wide_part = 100,
    vertical_merge_algorithm_min_rows_to_activate = 1,
    vertical_merge_algorithm_min_columns_to_activate = 1,
    allow_vertical_merges_from_compact_to_wide_parts = 1;

INSERT INTO t_compact_vertical_merge SELECT number, toString(number), range(number % 10) FROM numbers(40);
INSERT INTO t_compact_vertical_merge SELECT number, toString(number), range(number % 10) FROM numbers(40);

OPTIMIZE TABLE t_compact_vertical_merge FINAL;
SYSTEM FLUSH LOGS;

WITH splitByChar('_', part_name) AS name_parts,
    name_parts[2]::UInt64 AS min_block,
    name_parts[3]::UInt64 AS max_block
SELECT min_block, max_block, event_type, merge_algorithm, part_type FROM system.part_log
WHERE
    database = currentDatabase() AND
    table = 't_compact_vertical_merge' AND
    min_block = 1 AND max_block = 2;

INSERT INTO t_compact_vertical_merge SELECT number, toString(number), range(number % 10) FROM numbers(40);

OPTIMIZE TABLE t_compact_vertical_merge FINAL;
SYSTEM FLUSH LOGS;

WITH splitByChar('_', part_name) AS name_parts,
    name_parts[2]::UInt64 AS min_block,
    name_parts[3]::UInt64 AS max_block
SELECT min_block, max_block, event_type, merge_algorithm, part_type FROM system.part_log
WHERE
    database = currentDatabase() AND
    table = 't_compact_vertical_merge' AND
    min_block = 1 AND max_block = 3;

DROP TABLE t_compact_vertical_merge;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02560_vertical_merge_memory_usage.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-s3-storage
drop table if exists tvm;
create table tvm (c0 UInt64, c1 UInt64, c2 UInt64, c3 UInt64, c4 UInt64, c5 UInt64, c6 UInt64, c7 UInt64, c8 UInt64, c9 UInt64, c10 UInt64, c11 UInt64, c12 UInt64, c13 UInt64, c14 UInt64, c15 UInt64, c16 UInt64, c17 UInt64, c18 UInt64, c19 UInt64, c20 UInt64, c21 UInt64, c22 UInt64, c23 UInt64, c24 UInt64, c25 UInt64, c26 UInt64, c27 UInt64, c28 UInt64, c29 UInt64, c30 UInt64, c31 UInt64, c32 UInt64, c33 UInt64, c34 UInt64, c35 UInt64, c36 UInt64, c37 UInt64, c38 UInt64, c39 UInt64, c40 UInt64, c41 UInt64, c42 UInt64, c43 UInt64, c44 UInt64, c45 UInt64, c46 UInt64, c47 UInt64, c48 UInt64, c49 UInt64, c50 UInt64, c51 UInt64, c52 UInt64, c53 UInt64, c54 UInt64, c55 UInt64, c56 UInt64, c57 UInt64, c58 UInt64, c59 UInt64, c60 UInt64, c61 UInt64, c62 UInt64, c63 UInt64, c64 UInt64, c65 UInt64, c66 UInt64, c67 UInt64, c68 UInt64, c69 UInt64, c70 UInt64, c71 UInt64, c72 UInt64, c73 UInt64, c74 UInt64, c75 UInt64, c76 UInt64, c77 UInt64, c78 UInt64, c79 UInt64, c80 UInt64, c81 UInt64, c82 UInt64, c83 UInt64, c84 UInt64, c85 UInt64, c86 UInt64, c87 UInt64, c88 UInt64, c89 UInt64, c90 UInt64, c91 UInt64, c92 UInt64, c93 UInt64, c94 UInt64, c95 UInt64, c96 UInt64, c97 UInt64, c98 UInt64, c99 UInt64, c100 UInt64, c101 UInt64, c102 UInt64, c103 UInt64, c104 UInt64, c105 UInt64, c106 UInt64, c107 UInt64, c108 UInt64, c109 UInt64, c110 UInt64, c111 UInt64, c112 UInt64, c113 UInt64, c114 UInt64, c115 UInt64, c116 UInt64, c117 UInt64, c118 UInt64, c119 UInt64, c120 UInt64, c121 UInt64, c122 UInt64, c123 UInt64, c124 UInt64, c125 UInt64, c126 UInt64, c127 UInt64, c128 UInt64, c129 UInt64, c130 UInt64, c131 UInt64, c132 UInt64, c133 UInt64, c134 UInt64, c135 UInt64, c136 UInt64, c137 UInt64, c138 UInt64, c139 UInt64, c140 UInt64, c141 UInt64, c142 UInt64, c143 UInt64, c144 UInt64, c145 UInt64, c146 UInt64, c147 UInt64, c148 UInt64, c149 UInt64, c150 UInt64, c151 UInt64, c152 UInt64, c153 UInt64, c154 UInt64, c155 UInt64, c156 UInt64, c157 UInt64, c158 UInt64, c159 UInt64, c160 UInt64, c161 UInt64, c162 UInt64, c163 UInt64, c164 UInt64, c165 UInt64, c166 UInt64, c167 UInt64, c168 UInt64, c169 UInt64, c170 UInt64, c171 UInt64, c172 UInt64, c173 UInt64, c174 UInt64, c175 UInt64, c176 UInt64, c177 UInt64, c178 UInt64, c179 UInt64, c180 UInt64, c181 UInt64, c182 UInt64, c183 UInt64, c184 UInt64, c185 UInt64, c186 UInt64, c187 UInt64, c188 UInt64, c189 UInt64, c190 UInt64, c191 UInt64, c192 UInt64, c193 UInt64, c194 UInt64, c195 UInt64, c196 UInt64, c197 UInt64, c198 UInt64, c199 UInt64, c200 UInt64, c201 UInt64, c202 UInt64, c203 UInt64, c204 UInt64, c205 UInt64, c206 UInt64, c207 UInt64, c208 UInt64, c209 UInt64, c210 UInt64, c211 UInt64, c212 UInt64, c213 UInt64, c214 UInt64, c215 UInt64, c216 UInt64, c217 UInt64, c218 UInt64, c219 UInt64, c220 UInt64, c221 UInt64, c222 UInt64, c223 UInt64, c224 UInt64, c225 UInt64, c226 UInt64, c227 UInt64, c228 UInt64, c229 UInt64, c230 UInt64, c231 UInt64, c232 UInt64, c233 UInt64, c234 UInt64, c235 UInt64, c236 UInt64, c237 UInt64, c238 UInt64, c239 UInt64, c240 UInt64, c241 UInt64, c242 UInt64, c243 UInt64, c244 UInt64, c245 UInt64, c246 UInt64, c247 UInt64, c248 UInt64, c249 UInt64, c250 UInt64, c251 UInt64, c252 UInt64, c253 UInt64, c254 UInt64, c255 UInt64, c256 UInt64, c257 UInt64, c258 UInt64, c259 UInt64, c260 UInt64, c261 UInt64, c262 UInt64, c263 UInt64, c264 UInt64, c265 UInt64, c266 UInt64, c267 UInt64, c268 UInt64, c269 UInt64, c270 UInt64, c271 UInt64, c272 UInt64, c273 UInt64, c274 UInt64, c275 UInt64, c276 UInt64, c277 UInt64, c278 UInt64, c279 UInt64, c280 UInt64, c281 UInt64, c282 UInt64, c283 UInt64, c284 UInt64, c285 UInt64, c286 UInt64, c287 UInt64, c288 UInt64, c289 UInt64, c290 UInt64, c291 UInt64, c292 UInt64, c293 UInt64, c294 UInt64, c295 UInt64, c296 UInt64, c297 UInt64, c298 UInt64, c299 UInt64) engine = MergeTree order by tuple() settings min_rows_for_wide_part = 10, min_bytes_for_wide_part=0, vertical_merge_algorithm_min_rows_to_activate=1;

insert into tvm select number + 0, number + 1, number + 2, number + 3, number + 4, number + 5, number + 6, number + 7, number + 8, number + 9, number + 10, number + 11, number + 12, number + 13, number + 14, number + 15, number + 16, number + 17, number + 18, number + 19, number + 20, number + 21, number + 22, number + 23, number + 24, number + 25, number + 26, number + 27, number + 28, number + 29, number + 30, number + 31, number + 32, number + 33, number + 34, number + 35, number + 36, number + 37, number + 38, number + 39, number + 40, number + 41, number + 42, number + 43, number + 44, number + 45, number + 46, number + 47, number + 48, number + 49, number + 50, number + 51, number + 52, number + 53, number + 54, number + 55, number + 56, number + 57, number + 58, number + 59, number + 60, number + 61, number + 62, number + 63, number + 64, number + 65, number + 66, number + 67, number + 68, number + 69, number + 70, number + 71, number + 72, number + 73, number + 74, number + 75, number + 76, number + 77, number + 78, number + 79, number + 80, number + 81, number + 82, number + 83, number + 84, number + 85, number + 86, number + 87, number + 88, number + 89, number + 90, number + 91, number + 92, number + 93, number + 94, number + 95, number + 96, number + 97, number + 98, number + 99, number + 100, number + 101, number + 102, number + 103, number + 104, number + 105, number + 106, number + 107, number + 108, number + 109, number + 110, number + 111, number + 112, number + 113, number + 114, number + 115, number + 116, number + 117, number + 118, number + 119, number + 120, number + 121, number + 122, number + 123, number + 124, number + 125, number + 126, number + 127, number + 128, number + 129, number + 130, number + 131, number + 132, number + 133, number + 134, number + 135, number + 136, number + 137, number + 138, number + 139, number + 140, number + 141, number + 142, number + 143, number + 144, number + 145, number + 146, number + 147, number + 148, number + 149, number + 150, number + 151, number + 152, number + 153, number + 154, number + 155, number + 156, number + 157, number + 158, number + 159, number + 160, number + 161, number + 162, number + 163, number + 164, number + 165, number + 166, number + 167, number + 168, number + 169, number + 170, number + 171, number + 172, number + 173, number + 174, number + 175, number + 176, number + 177, number + 178, number + 179, number + 180, number + 181, number + 182, number + 183, number + 184, number + 185, number + 186, number + 187, number + 188, number + 189, number + 190, number + 191, number + 192, number + 193, number + 194, number + 195, number + 196, number + 197, number + 198, number + 199, number + 200, number + 201, number + 202, number + 203, number + 204, number + 205, number + 206, number + 207, number + 208, number + 209, number + 210, number + 211, number + 212, number + 213, number + 214, number + 215, number + 216, number + 217, number + 218, number + 219, number + 220, number + 221, number + 222, number + 223, number + 224, number + 225, number + 226, number + 227, number + 228, number + 229, number + 230, number + 231, number + 232, number + 233, number + 234, number + 235, number + 236, number + 237, number + 238, number + 239, number + 240, number + 241, number + 242, number + 243, number + 244, number + 245, number + 246, number + 247, number + 248, number + 249, number + 250, number + 251, number + 252, number + 253, number + 254, number + 255, number + 256, number + 257, number + 258, number + 259, number + 260, number + 261, number + 262, number + 263, number + 264, number + 265, number + 266, number + 267, number + 268, number + 269, number + 270, number + 271, number + 272, number + 273, number + 274, number + 275, number + 276, number + 277, number + 278, number + 279, number + 280, number + 281, number + 282, number + 283, number + 284, number + 285, number + 286, number + 287, number + 288, number + 289, number + 290, number + 291, number + 292, number + 293, number + 294, number + 295, number + 296, number + 297, number + 298, number + 299 from numbers(20);

optimize table tvm final;

system flush logs;
-- should be about 4MB
select formatReadableSize(peak_memory_usage), * from system.part_log where table = 'tvm' and database = currentDatabase() and event_date >= today() - 1 and event_type = 'MergeParts' and peak_memory_usage > 100000000 format Vertical;

drop table tvm;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02561_with_fill_date_datetime_incompatible.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT today() AS a
ORDER BY a ASC WITH FILL FROM now() - toIntervalMonth(1) TO now() + toIntervalDay(1) STEP 82600; -- { serverError 475 }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02686_bson3.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- It correctly throws exception about incorrect data:

SELECT * FROM format(BSONEachRow, 'WatchID Int64, JavaEnable Int16, Title String, GoodEvent Int16, EventTime DateTime, EventDate Date, CounterID Int32, ClientIP Int32, RegionID Int32, UserID Int64, CounterClass Int16, OS Int16, UserAgent Int16, URL String, Referer String, IsRefresh Int16, RefererCategoryID Int16, RefererRegionID Int32, URLCategoryID Int16, URLRegionID Int32, ResolutionWidth Int16, ResolutionHeight Int16, ResolutionDepth Int16, FlashMajor Int16, FlashMinor Int16, FlashMinor2 String, NetMajor Int16, NetMinor Int16, UserAgentMajor Int16, UserAgentMinor String, CookieEnable Int16, JavascriptEnable Int16, IsMobile Int16, MobilePhone Int16, MobilePhoneModel String, Params String, IPNetworkID Int32, TraficSourceID Int16, SearchEngineID Int16, SearchPhrase String, AdvEngineID Int16, IsArtifical Int16, WindowClientWidth Int16, WindowClientHeight Int16, ClientTimeZone Int16, ClientEventTime DateTime, SilverlightVersion1 Int16, SilverlightVersion2 Int16, SilverlightVersion3 Int32, SilverlightVersion4 Int16, PageCharset String, CodeVersion Int32, IsLink Int16, IsDownload Int16, IsNotBounce Int16, FUniqID Int64, OriginalURL String, HID Int32, IsOldCounter Int16, IsEvent Int16, IsParameter Int16, DontCountHits Int16, WithHash Int16, HitColor String, LocalEventTime DateTime, Age Int16, Sex Int16, Income Int16, Interests Int16, Robotness Int16, RemoteIP Int32, WindowName Int32, OpenerName Int32, HistoryLength Int16, BrowserLanguage String, BrowserCountry String, SocialNetwork String, SocialAction String, HTTPError Int16, SendTiming Int32, DNSTiming Int32, ConnectTiming Int32, ResponseStartTiming Int32, ResponseEndTiming Int32, FetchTiming Int32, SocialSourceNetworkID Int16, SocialSourcePage String, ParamPrice Int64, ParamOrderID String, ParamCurrency String, ParamCurrencyID Int16, OpenstatServiceName String, OpenstatCampaignID String, OpenstatAdID String, OpenstatSourceID String, UTMSource String, UTMMedium String, UTMCampaign String, UTMContent String, UTMTerm String, FromTag String, HasGCLID Int16, RefererHash Int64, URLHash Int64, CLID Int32',
$$^  WatchID c*5/ !p~JavaEnable     Title      GoodEvent    EventTime 7Q    EventDate >  CounterID    ClientIP zRegionID G  UserID  :6CounterClass     OS     UserAgent     URL      Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID     ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor     UserAgentMinor     �OCookieEnable     JavascriptEnablsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime &Q    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash |3b.CLID      ^  WatchID Fӓ2qJavaEnable     Title      GoodEvent    EventTime n$Q    EventDate >  CounterID    ClientIP zRegionID G  UserID  :6CounterClass     OS     UserAgent     URL      Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID     ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor     UserAgentMinor     �OCookieEnable     JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime ǘQ    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      PamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash |3b.CLID      ^  WatchID l!|@HJavaEnable     Title      GoodEvent    EventTime )Q    EventDate >  CounterID    ClientIP zRegionID G  UserID  :6CounterClass     OS     UserAgent     URL      Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID     ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor     UserAgentMinor     �OCookieEnable     JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime }Q    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash |3b.CLID      ^  WatchID ǐ=ЌWJavaEnable     Title      GoodEvent    EventTime 8*Q    EventDate >  CounterID    ClientIP zRegionID G  UserID  :6CounterClass     OS     UserAgent     URL      Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID     ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor     UserAgentMinor     �OCookieEnable     JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime ݞQ    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash |3b.CLID        WatchID E&LyJavaEnable     Title      GoodEvent    EventTime JQ    EventDate >  CounterID    ClientIP I`RegionID '   UserID qJd8CounterClass     OS    UserAgent    URL -    http://holodilnik.ru/russia/05jul2013&model=0Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCateParams String, IPNetworkID Int32, TraficSourceID Int16, SearchEngineID Int16, SearchPhrase String, AdvEngineID Int16, IsArtifical Int16, WindowClientWidth Int16, WindowClientHeight Int16, ClientTimeZone Int16, ClientEventTime DateTime, SilverlightVersion1 Int16, SilverlightVersion2 Int16, SilverlightVersion3 Int32, SilverlightVersion4 Int16, PageCharset String, CodeVersion Int32, IsLink Int16, IsDownload Int16, IsNotBounce Int16, FUniqID Int64, OriginalURL String, HID Int32, IsOldCounter Int16, IsEvent Int16, IsParameter Int16, DontCountHits Int16, WithHash Int16, HitColor String, LocalEventTime DateTime, Age Int16, Sex Int16, Income Int16, Interests Int16, Robotness Int16, RemoteIP Int32, WindowName Int32, OpenerName Int32, HistoryLength Int16, BrowserLanguage String, BrowserCountry String, SocialNetwork String, SocialAction String, HTTPError Int16, SendTiming Int32, DNSTiming Int32, ConnectTiming Int32, ResponseStartTiming Int32, ResponseEndTiming Int32, HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash 
oeCLID        WatchID k=pJavaEnable     Title      GoodEvent    EventTime Q    EventDate >  CounterID    ClienQ9HRegionID G  UserID 
Ks}CounterClass     OS    UserAgent    URL H    http://afisha.mail.ru/catalog/314/women.ru/ency=1&page3/?errovat-pinnikiReferer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID 0=  URLRegionID    ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor    UserAgentMinor     D�CookieEnable    JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     
PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID :WmOriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime AQ    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash 
#\CLID        WatchID 1oCJavaEnable     Title      GoodEvent    EventTime 0Q    EventDate >  CounterID    ClientIP ^{]RegionID    UserID &n%t"6CounterClass     OS '   UserAgent    URL >    http://bonprix.ru/index.ru/cinema/art/0 986 424 233 сезонReferer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID    URLRegionID    ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor    UserAgentMinor     D�CookieEnable    JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID #( TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime Q    Age     Sex     Income     Interests     Robotness     RemoteIP UWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash X-hX CLID        WatchID »-C_JavaEnable     Title      GoodEvent    EventTime 83Q    EventDate >  CounterID    ClientIP ^{]RegionID    UserID &n%t"6CounterClass     OS '   UserAgent    URL :    http://bonprix.ru/index.ru/cinema/art/A00387,3797); ru)&bLReferer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID    URLRegionID    ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor    UserAgentMinor     D�CookieEnable    JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID #( TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime 
Q    Age     Sex     Income     Interests     Robotness     RemoteIP UWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash vvCLID        WatchID \JavaEnable     Title      GoodEvent    EventTime  Q    EventDate >  CounterID    ClientIP gURegionID    UserID syyfCounterClass     OS ,   UserAgent    URL 1    http://tours/Ekategoriya%2F&sr=http://slovareniyeReferer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID    esRolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor 	   UserAgentMinor     D�CookieEnable     JavascriptEnable     IsMobile     MobilePhone     MobilePhoneModel      Params      IPNetworkID  TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime YQ    Age     Sex     Income     Interests     Robotness     RemoteIP =kWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash h9DCLID      ^  WatchID /EJ{JavaEnable     Title      GoodEvent    EventTime 1Q    EventDate >  CounterID    ClientIP zRegionID G  UserID  :6CounterClass     OS     UserAgent     URL      Referer      IsRefresh     RefererCategoryID     RefererRegionID     URLCategoryID     URLRegionID     ResolutionWidth     ResolutionHeight     ResolutionDepth     FlashMajor     FlashMinor     FlashMinor2      NetMajor     NetMinor     UserAgentMajor     UserAgentMinor     �OCookieEnable     JavascriptEnable     IsMobile     MobilePhone     MobilePhkneModel      Params      IPNetworkID 9 TraficSourceID    SearchEngineID     SearchPhrase      AdvEngineID     IsArtifical     WindowClientWidth     WindowClientHeight     ClientTimeZone ClientEventTime     SilverlightVersion1     SilverlightVersion2     SilverlightVersion3     SilverlightVersion4     PageCharset      CodeVersion     IsLink     IsDownload     IsNotBounce     FUniqID         OriginalURL      HID     IsOldCounter     IsEvent     IsParameter     DontCountHits     WithHash     HitColor     5LocalEventTime Q    Age     Sex     Income     Interests     Robotness     RemoteIP ^DIWindowName OpenerName HistoryLength BrowserLanguage     �BrowserCountry     �SocialNetwork      SocialAction      HTTPError     SendTiming     DNSTiming     ConnectTiming     ResponseStartTiming     ResponseEndTiming     FetchTiming     SocialSourceNetworkID     SocialSourcePage      ParamPrice         ParamOrderID      ParamCurrency     NHParamCurrencyID     OpenstatServiceName      OpenstatCampaignID      OpenstatAdID      OpenstatSourceID      UTMSource      UTMMedium      UTMCampaign      UTMContent      UTMTerm      FromTag      HasGCLID     RefererHash X+'URLHash |3b.CLID      $$); -- { serverError INCORRECT_DATA }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02752_custom_separated_ignore_spaces_bug.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>select * from format(CustomSeparatedIgnoreSpaces, 'x String', ' unquoted_string\n') settings format_custom_escaping_rule='CSV';
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02807_lower_utf8_msan.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT lowerUTF8(arrayJoin(['©--------------------------------------', '©--------------------'])) ORDER BY 1;
SELECT upperUTF8(materialize('aaaaАБВГaaaaaaaaaaaaАБВГAAAAaaAA')) FROM numbers(2);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02814_create_index_uniq_noop.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET allow_create_index_without_type=1;
SET create_index_ignore_unique=1;
CREATE UNIQUE INDEX idx_tab2_0 ON tab2 (col1);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02815_fix_not_found_constants_col_in_block.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t0;
CREATE TABLE t0 (vkey UInt32, c0 Float32, primary key(c0)) engine = AggregatingMergeTree;
insert into t0 values (19000, 1);
select null as c_2_0, ref_2.c0 as c_2_1, ref_2.vkey as c_2_2 from t0 as ref_2 order by c_2_0 asc, c_2_1 asc, c_2_2 asc;
select null as c_2_0, ref_2.c0 as c_2_1, ref_2.vkey as c_2_2 from t0 as ref_2 order by c_2_0 asc, c_2_1 asc;
DROP TABLE t0;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02861_index_set_incorrect_args.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/52019
DROP TABLE IF EXISTS set_index__fuzz_41;
CREATE TABLE set_index__fuzz_41 (`a` Date, `b` Nullable(DateTime64(3)), INDEX b_set b TYPE set(0) GRANULARITY 1) ENGINE = MergeTree ORDER BY tuple();
INSERT INTO set_index__fuzz_41 (a) VALUES (today());
SELECT b FROM set_index__fuzz_41 WHERE and(b = 256) SETTINGS force_data_skipping_indices = 'b_set', optimize_move_to_prewhere = 0, max_parallel_replicas=2, parallel_replicas_for_non_replicated_merge_tree=1, allow_experimental_parallel_reading_from_replicas=2; -- { serverError TOO_FEW_ARGUMENTS_FOR_FUNCTION }
DROP TABLE set_index__fuzz_41;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02874_parse_json_as_json_each_row_on_no_metadata.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>desc format(JSON, '{"a" : 10, "b" : "Hello"}');
select * from format(JSON, '{"a" : 10, "b" : "Hello"}');

</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02900_date_time_check_overflow.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SET session_timezone = 'UTC';

SELECT 'ignore';
SET date_time_overflow_behavior = 'ignore';
SELECT toDateTime(toDateTime64('1900-01-01 00:00:00.123', 3));
SELECT toDateTime(toDateTime64('2299-12-31 23:59:59.999', 3));

SELECT toDateTime(toDate32('1900-01-01'));
SELECT toDateTime(toDate32('2299-12-31'));

SELECT toDateTime(toDate('2149-06-06'));

SELECT toDate(toDateTime64('1900-01-01 00:00:00.123', 3));
SELECT toDate(toDateTime64('2149-06-07 00:00:00.123', 3));
SELECT toDate(toDateTime64('2299-12-31 23:59:59.999', 3));

SELECT toDate(toDate32('1900-01-01'));
SELECT toDate(toDate32('2299-12-31'));


SELECT 'No output on `throw`';
SET date_time_overflow_behavior = 'throw';
SELECT toDateTime(toDateTime64('1900-01-01 00:00:00.123', 3)); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDateTime(toDateTime64('2299-12-31 23:59:59.999', 3)); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDateTime(toDate32('1900-01-01')); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDateTime(toDate32('2299-12-31')); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDateTime(toDate('2149-06-06')); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDate(toDateTime64('1900-01-01 00:00:00.123', 3)); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDate(toDateTime64('2299-12-31 23:59:59.999', 3)); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDate(toDate32('1900-01-01')); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }
SELECT toDate(toDate32('2299-12-31')); -- { serverError VALUE_IS_OUT_OF_RANGE_OF_DATA_TYPE }


SELECT 'saturate';
SET date_time_overflow_behavior = 'saturate';

SELECT toDateTime(toDateTime64('1900-01-01 00:00:00.123', 3));
SELECT toDateTime(toDateTime64('2299-12-31 23:59:59.999', 3));

SELECT toDateTime(toDate32('1900-01-01'));
SELECT toDateTime(toDate32('2299-12-31'));

SELECT toDateTime(toDate('2149-06-06'));

SELECT toDate(toDateTime64('1900-01-01 00:00:00.123', 3));
SELECT toDate(toDateTime64('2149-06-07 00:00:00.123', 3));
SELECT toDate(toDateTime64('2299-12-31 23:59:59.999', 3));

SELECT toDate(toDate32('1900-01-01'));
SELECT toDate(toDate32('2299-12-31'));
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02910_rocksdb_optimize.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: use-rocksdb

CREATE TABLE dict (key UInt64, value String) ENGINE = EmbeddedRocksDB PRIMARY KEY key;
INSERT INTO dict SELECT number, toString(number) FROM numbers(1e3);
OPTIMIZE TABLE dict;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02915_analyzer_fuzz_5.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>set allow_experimental_analyzer=1;
SET max_block_size = 1000;
SET max_threads = 4;
SET max_rows_to_group_by = 3000, group_by_overflow_mode = 'any';
SELECT 'limit w/ GROUP BY', count(NULL), number FROM remote('127.{1,2}', view(SELECT intDiv(number, 2147483647)
 AS number FROM numbers(10))) GROUP BY number WITH ROLLUP ORDER BY count() ASC, number DESC NULLS LAST SETTINGS limit = 2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02916_distributed_skip_unavailable_shards.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: shard, no-fasttest

DROP TABLE IF EXISTS table_02916;
DROP TABLE IF EXISTS table_02916_distributed;

CREATE TABLE table_02916
(
    `ID` UInt32,
    `Name` String
)
ENGINE = MergeTree
ORDER BY ID;

INSERT INTO table_02916 VALUES (1234, 'abcd');

CREATE TABLE table_02916_distributed
(
    `ID` UInt32,
    `Name` String
)
ENGINE = Distributed(test_unavailable_shard, currentDatabase(), table_02916, rand())
SETTINGS skip_unavailable_shards = 1;

SET send_logs_level='fatal';
SELECT *, _shard_num FROM table_02916_distributed;

DROP TABLE table_02916_distributed;
DROP TABLE table_02916;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>02932_set_ttl_where.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- Tags: no-ordinary-database

create or replace table t_temp (
    a UInt32,
    timestamp DateTime
)
engine = MergeTree
order by a
TTL timestamp + INTERVAL 2 SECOND WHERE a in (select number from system.numbers limit 100_000);

select sleep(1);
insert into t_temp select rand(), now() from system.numbers limit 1_000_000;
select sleep(1);
insert into t_temp select rand(), now() from system.numbers limit 1_000_000;
select sleep(1);
optimize table t_temp final;

DROP TABLE t_temp;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02935_format_with_arbitrary_types.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>
-- Tags: no-fasttest
-- no-fasttest: json type needs rapidjson library, geo types need s2 geometry

SET allow_experimental_object_type = 1;
SET allow_suspicious_low_cardinality_types=1;

SELECT '-- Const string + non-const arbitrary type';
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(42 :: Int8));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(43 :: Int16));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(44 :: Int32));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(45 :: Int64));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(46 :: Int128));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(47 :: Int256));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(48 :: UInt8));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(49 :: UInt16));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(50 :: UInt32));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(51 :: UInt64));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(52 :: UInt128));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(53 :: UInt256));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(42.42 :: Float32));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(43.43 :: Float64));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(44.44 :: Decimal(2)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(true :: Bool));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(false :: Bool));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('foo' :: String));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('bar' :: FixedString(3)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('foo' :: Nullable(String)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('bar' :: Nullable(FixedString(3))));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('foo' :: LowCardinality(String)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('bar' :: LowCardinality(FixedString(3))));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('foo' :: LowCardinality(Nullable(String))));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('bar' :: LowCardinality(Nullable(FixedString(3)))));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(42 :: LowCardinality(Nullable(UInt32))));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(42 :: LowCardinality(UInt32)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('fae310ca-d52a-4923-9e9b-02bf67f4b009' :: UUID));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('2023-11-14' :: Date));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('2123-11-14' :: Date32));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('2023-11-14 05:50:12' :: DateTime('Europe/Amsterdam')));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('2023-11-14 05:50:12.123' :: DateTime64(3, 'Europe/Amsterdam')));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('hallo' :: Enum('hallo' = 1)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(['foo', 'bar'] :: Array(String)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('{"foo": "bar"}' :: JSON));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize((42, 'foo') :: Tuple(Int32, String)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize(map(42, 'foo') :: Map(Int32, String)));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('122.233.64.201' :: IPv4));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize('2001:0001:130F:0002:0003:09C0:876A:130B' :: IPv6));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize((42, 43) :: Point));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize([(0,0),(10,0),(10,10),(0,10)] :: Ring));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize([[(20, 20), (50, 20), (50, 50), (20, 50)], [(30, 30), (50, 50), (50, 30)]] :: Polygon));
SELECT format('The {0} to all questions is {1}.', 'answer', materialize([[[(0, 0), (10, 0), (10, 10), (0, 10)]], [[(20, 20), (50, 20), (50, 50), (20, 50)],[(30, 30), (50, 50), (50, 30)]]] :: MultiPolygon));

SELECT '-- Nested';
DROP TABLE IF EXISTS format_nested;
CREATE TABLE format_nested(attrs Nested(k String, v String)) ENGINE = MergeTree ORDER BY tuple();
INSERT INTO format_nested VALUES (['foo', 'bar'], ['qaz', 'qux']);
SELECT format('The {0} to all questions is {1}.', attrs.k, attrs.v) FROM format_nested;
DROP TABLE format_nested;

SELECT '-- NULL arguments';
SELECT format('The {0} to all questions is {1}', NULL, NULL);
SELECT format('The {0} to all questions is {1}', NULL, materialize(NULL :: Nullable(UInt64)));
SELECT format('The {0} to all questions is {1}', materialize(NULL :: Nullable(UInt64)), materialize(NULL :: Nullable(UInt64)));
SELECT format('The {0} to all questions is {1}', 42, materialize(NULL :: Nullable(UInt64)));
SELECT format('The {0} to all questions is {1}', '42', materialize(NULL :: Nullable(UInt64)));
SELECT format('The {0} to all questions is {1}', 42, materialize(NULL :: Nullable(UInt64)), materialize(NULL :: Nullable(UInt64)));
SELECT format('The {0} to all questions is {1}', '42', materialize(NULL :: Nullable(UInt64)), materialize(NULL :: Nullable(UInt64)));

SELECT '-- Various arguments tests';
SELECT format('The {0} to all questions is {1}', materialize('Non-const'), materialize(' strings'));
SELECT format('The {0} to all questions is {1}', 'Two arguments ', 'test');
SELECT format('The {0} to all questions is {1} and {2}', 'Three ', 'arguments', ' test');
SELECT format('The {0} to all questions is {1} and {2}', materialize(3 :: Int64), ' arguments test', ' with int type');
SELECT format('The {0} to all questions is {1}', materialize(42 :: Int32), materialize(144 :: UInt64));
SELECT format('The {0} to all questions is {1} and {2}', materialize(42 :: Int32), materialize(144 :: UInt64), materialize(255 :: UInt32));
SELECT format('The {0} to all questions is {1}', 42, 144);
SELECT format('The {0} to all questions is {1} and {2}', 42, 144, 255);

SELECT '-- Single argument tests';
SELECT format('The answer to all questions is {0}.', 42);
SELECT format('The answer to all questions is {0}.', materialize(42));
SELECT format('The answer to all questions is {0}.', 'foo');
SELECT format('The answer to all questions is {0}.', materialize('foo'));
SELECT format('The answer to all questions is {0}.', NULL);
SELECT format('The answer to all questions is {0}.', materialize(NULL :: Nullable(UInt64)));
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>02982_parallel_replicas_unexpected_cluster.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS test_unexpected_cluster;
CREATE TABLE test_unexpected_cluster (n UInt64) ENGINE=MergeTree() ORDER BY tuple();
INSERT INTO test_unexpected_cluster SELECT * FROM numbers(10);

SET allow_experimental_parallel_reading_from_replicas=2, max_parallel_replicas=2, cluster_for_parallel_replicas='test_cluster_two_shards', parallel_replicas_for_non_replicated_merge_tree=1;
SELECT count() FROM test_unexpected_cluster WHERE NOT ignore(*); -- { serverError UNEXPECTED_CLUSTER }

DROP TABLE test_unexpected_cluster;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>03003_analyzer_setting.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>CREATE TABLE test (dummy Int8) ENGINE = Distributed(test_cluster_two_shards, 'system', 'one');

SET allow_experimental_analyzer = 0;

SELECT * FROM (SELECT * FROM test SETTINGS allow_experimental_analyzer = 1); -- { serverError INCORRECT_QUERY }

SET allow_experimental_analyzer = 1;

SELECT * FROM (SELECT * FROM test SETTINGS allow_experimental_analyzer = 0); -- { serverError INCORRECT_QUERY }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03013_group_by_use_nulls_with_materialize_and_analyzer.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>set allow_experimental_analyzer = 1;
set group_by_use_nulls = 1;
set optimize_group_by_function_keys = 1;
set optimize_injective_functions_in_group_by = 1;

SELECT 3 + 3 from numbers(10) GROUP BY GROUPING SETS (('str'), (3 + 3)) order by all;
SELECT materialize(3) from numbers(10) GROUP BY GROUPING SETS (('str'), (materialize(3))) order by all;
SELECT ignore(3) from numbers(10) GROUP BY GROUPING SETS (('str'), (ignore(3))) order by all;
SELECT materialize(ignore(3)) from numbers(10) GROUP BY GROUPING SETS (('str'), (materialize(ignore(3)))) order by all;
SELECT ignore(materialize(3)) from numbers(10) GROUP BY GROUPING SETS (('str'), (ignore(materialize(3)))) order by all;

</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03035_morton_encode_no_rows.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT mortonEncode(materialize((1, 1)), 65534, 65533);
SELECT mortonEncode((1, 1), 65534, 65533);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03042_not_found_column_c1.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/42399
SET allow_experimental_analyzer=1;

CREATE TABLE IF NOT EXISTS t0 (c0 Int32) ENGINE = Memory() ;
CREATE TABLE t1 (c0 Int32, c1 Int32, c2 Int32) ENGINE = Memory() ;
CREATE TABLE t2 (c0 String, c1 String MATERIALIZED (c2), c2 Int32) ENGINE = Memory() ;
CREATE TABLE t3 (c0 String, c1 String, c2 String) ENGINE = Log() ;
CREATE TABLE IF NOT EXISTS t4 (c0 Int32) ENGINE = Log() ;
SELECT t3.c1, t3.c2, t1.c1, t1.c0, t2.c2, t0.c0, t1.c2, t2.c1, t4.c0 FROM t3, t0, t1, t2, t4;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03057_analyzer_subquery_alias_join.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/10276
SET allow_experimental_analyzer=1;
SELECT
    sum(x.n) as n,
    sum(z.n) as n2
FROM
(
    SELECT 1000 AS n,1 as id
) AS x
join (select 10000 as n,1 as id) as y
on x.id = y.id
left join (select 100000 as n,1 as id) as z
on x.id = z.id;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03100_analyzer_constants_in_multiif.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/59101
SET allow_experimental_analyzer = 1;

CREATE TABLE users (name String, age Int16) ENGINE=Memory;
INSERT INTO users VALUES ('John', 33);
INSERT INTO users VALUES ('Ksenia', 48);
INSERT INTO users VALUES ('Alice', 50);

SELECT
    multiIf((age > 30) or (true), '1', '2') AS a,
    max(name)
FROM users
GROUP BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03101_analyzer_identifiers_2.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/23194
SET allow_experimental_analyzer = 1;

CREATE TEMPORARY TABLE test1 (a String, nest Nested(x String, y String));

SELECT a, nest.* FROM test1 ARRAY JOIN nest;
SELECT a, n.* FROM test1 ARRAY JOIN nest AS n;

CREATE TEMPORARY TABLE test2 (a String, nest Array(Tuple(x String, y String)));

SELECT a, nest.* FROM test2 ARRAY JOIN nest;
SELECT a, n.* FROM test2 ARRAY JOIN nest AS n;


SELECT 1 AS x, x, x + 1;
SELECT x, x + 1, 1 AS x;
SELECT x, 1 + (2 + (3 AS x));

SELECT '---';

SELECT 123 AS x FROM (SELECT a, x FROM (SELECT 1 AS a, 2 AS b));

SELECT '---';

SELECT 123 AS x, (SELECT x) AS y;
SELECT 123 AS x, 123 IN (SELECT x);

SELECT '---';

WITH 123 AS x SELECT 555 FROM (SELECT a, x FROM (SELECT 1 AS a, 2 AS b));

SELECT '---';

-- here we refer to table `test1` (defined as subquery) three times, one of them inside another scalar subquery.
WITH t AS (SELECT 1) SELECT t, (SELECT * FROM t) FROM t; -- { serverError UNKNOWN_IDENTIFIER }

-- throws, because x is not visible outside.
SELECT x FROM (SELECT y FROM VALUES ('y UInt16', (2)) WHERE (1 AS x) = y) AS t;  -- { serverError UNKNOWN_IDENTIFIER }

-- throws, because the table name `t` is not visible outside
SELECT t.x FROM (SELECT * FROM (SELECT 1 AS x) AS t); -- { serverError UNKNOWN_IDENTIFIER }
SELECT x FROM (SELECT * FROM (SELECT 99 AS x) AS t);

SELECT '---';

SELECT t.x FROM (SELECT 1 AS x) AS t;
SELECT t.a FROM (SELECT a FROM test1) AS t;
SELECT a FROM (SELECT a FROM test1) AS t;

SELECT '---';

-- this is wrong, the `tbl` name is not exported
SELECT test1.a FROM (SELECT a FROM test1) AS t; -- { serverError UNKNOWN_IDENTIFIER }
-- this is also wrong, the `t2` alias is not exported
SELECT test1.a FROM (SELECT a FROM test1 AS t2) AS t; -- { serverError UNKNOWN_IDENTIFIER }


-- does not work, `x` is not visible;
SELECT x, (SELECT 1 AS x); -- { serverError UNKNOWN_IDENTIFIER }
-- does not work either;
SELECT x IN (SELECT 1 AS x); -- { serverError UNKNOWN_IDENTIFIER }
-- this will work, but keep in mind that there are two different `x`.
SELECT x IN (SELECT 1 AS x) FROM (SELECT 1 AS x);

SELECT '---';

SELECT x + 1 AS x, x FROM (SELECT 1 AS x);
SELECT x, x + 1 AS x FROM (SELECT 1 AS x);
SELECT 1 AS x, 2 AS x; -- { serverError MULTIPLE_EXPRESSIONS_FOR_ALIAS }

SELECT '---';


SELECT arrayMap(x -> x + 1, [1, 2]);

SELECT x, arrayMap((x, y) -> x[1] + y + arrayFirst(x -> x != y, x), arr) FROM (SELECT 1 AS x, [([1, 2], 3), ([4, 5], 6)] AS arr);

SELECT x1, arrayMap((x2, y2) -> x2[1] + y2 + arrayFirst(x3 -> x3 != y2, x2), arr) FROM (SELECT 1 AS x1, [([1, 2], 3), ([4, 5], 6)] AS arr);

SELECT arrayMap(x -> [y * 2, (x + 1) AS y, 1 AS z], [1, 2]), y; -- { serverError UNKNOWN_IDENTIFIER }

-- TODO: this must work
--SELECT arrayMap(x -> [y * 2, (x + 1) AS y, 1 AS z], [1, 2]), z;

SELECT arrayMap(x -> (x + 1) AS y, [3, 5]), arrayMap(x -> (x || 'hello') AS y, ['qq', 'ww']);  -- { serverError MULTIPLE_EXPRESSIONS_FOR_ALIAS }
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03108_describe_union_all.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>-- https://github.com/ClickHouse/ClickHouse/issues/8030

SET allow_experimental_analyzer=1;

DESCRIBE (SELECT 1, 1 UNION ALL SELECT 1, 2);</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>03151_analyzer_view_read_only_necessary_columns.sql</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS test_table;
CREATE TABLE test_table
(
    id UInt64,
    value String
) ENGINE=MergeTree ORDER BY id;

DROP VIEW IF EXISTS test_view;
CREATE VIEW test_view AS SELECT id, value FROM test_table;

EXPLAIN header = 1 SELECT sum(id) FROM test_view settings allow_experimental_analyzer=1;

DROP VIEW test_view;
DROP TABLE test_table;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>shared3</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>PRAGMA auto_vacuum = 2;
CREATE TABLE t1(x, y);
INSERT INTO t1 VALUES(randomblob(500), randomblob(500));
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
INSERT INTO t1 SELECT randomblob(500), randomblob(500) FROM t1;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>BEGIN;
DELETE FROM t1 WHERE 1;
PRAGMA incremental_vacuum;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>upfrom4</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t5;
DROP TABLE IF EXISTS m1;
DROP TABLE IF EXISTS m2;
CREATE TABLE t5(a INTEGER PRIMARY KEY, b TEXT, c TEXT);
CREATE TABLE m1(x INTEGER PRIMARY KEY, y TEXT);
CREATE TABLE m2(u INTEGER PRIMARY KEY, v TEXT);
INSERT INTO t5 VALUES(1, 'one', 'ONE');
INSERT INTO t5 VALUES(2, 'two', 'TWO');
INSERT INTO t5 VALUES(3, 'three', 'THREE');
INSERT INTO t5 VALUES(4, 'four', 'FOUR');
INSERT INTO m1 VALUES(1, 'i');
INSERT INTO m1 VALUES(2, 'ii');
INSERT INTO m1 VALUES(3, 'iii');
INSERT INTO m2 VALUES(1, 'I');
INSERT INTO m2 VALUES(3, 'II');
INSERT INTO m2 VALUES(4, 'III');
SELECT * FROM t5;
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>BEGIN;
UPDATE t5 SET b=y, c=v FROM m1 LEFT JOIN m2 ON (x=u) WHERE x=a;
SELECT * FROM t5 ORDER BY a;
ROLLBACK;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>BEGIN;
UPDATE t5 SET b=y, c=v FROM m2 RIGHT JOIN m1 ON (x=u) WHERE x=a;
SELECT * FROM t5 ORDER BY a;
ROLLBACK;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t1(a INT PRIMARY KEY, b INT, c INT);
INSERT INTO t1(a) VALUES(1),(2),(8),(19);
CREATE TABLE c1(x INTEGER PRIMARY KEY, b INT);
INSERT INTO c1(x,b) VALUES(1,1),(8,8),(17,17),(NULL,NULL);
CREATE TABLE c2(x INT,c INT);
INSERT INTO c2(x,c) VALUES(2,2),(8,8),(NULL,NULL);
CREATE TABLE dual(dummy TEXT);
INSERT INTO dual VALUES('X');
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>BEGIN;
SELECT * FROM t1 ORDER BY a;
UPDATE t1 SET b=c1.b, c=c2.c
FROM dual, c1 NATURAL RIGHT JOIN c2
WHERE x=a;
SELECT * FROM t1 ORDER BY a;
ROLLBACK;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t2(x);
CREATE TRIGGER AFTER INSERT ON t2 BEGIN
UPDATE t1 SET b=c1.b, c=c2.c
FROM dual, c1 NATURAL RIGHT JOIN c2
WHERE x=a;
END;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>BEGIN;
SELECT * FROM t1 ORDER BY a;
INSERT INTO t2(x) VALUES(1);
SELECT * FROM t1 ORDER BY a;
ROLLBACK;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t2(x,y,z PRIMARY KEY) WITHOUT ROWID;
INSERT INTO t2 VALUES(89,-89,6);
CREATE TABLE t1(a INT,b TEXT,c TEXT,d REAL) STRICT;
INSERT INTO t1 VALUES(1,'xyz','def',4.5);
CREATE TRIGGER t1tr BEFORE UPDATE ON t1 BEGIN
INSERT INTO t1(a,b) VALUES(1000,'uvw');
UPDATE t1 SET b=NULL FROM (SELECT CAST(a AS varchar) FROM t1 ORDER BY b) NATURAL LEFT FULL JOIN t1 AS text;
END;
UPDATE t1 SET b=b|100;
SELECT * FROM t1 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>func7</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>SELECT ceil(99.9), ceiling(-99.01), floor(17), floor(-17.99);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT quote(ceil(NULL)), ceil('-99.99');
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(ln(5),2), log(100.0), log(100), log(2,'256');
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT ln(-5), log(-5,100.0);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT abs(-17.4)
</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT ceil(42.2)
</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT ceil(-42.2)
</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT round(exp(1.0),7)
</td><td>True</td><td>True</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT floor(42.8)
</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT floor(-42.8)
</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT round(ln(2.0),7)
</td><td>True</td><td>True</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT log(100.0)
</td><td>True</td><td>True</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT log10(1000.0)
</td><td>True</td><td>True</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT format('%.30f', log10(100.0) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT format('%.30f', ln(exp(2.0)) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT log(2.0, 64.0)
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT mod(9,4);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(pi(),7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT power(9,3);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(radians(45.0),7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(42.4);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(42.4382,2);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT sign(-8.4);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( sqrt(2), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT trunc(42.8), trunc(-42.8);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT acos(1);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT degrees(acos(0.5));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( asin(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT degrees( asin(0.5) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( atan(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT degrees( atan(1) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( atan2(1,0), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT degrees( atan2(1,0) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT cos(0);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT cos( radians(60.0) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT cos(0);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( sin(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT sin( radians(30) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( tan(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT tan( radians(45) );
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( sinh(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( cosh(0), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( tanh(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( asinh(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( acosh(1), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( atanh(0.5), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT acos(1);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT acos(1.0001);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( acos(0.0), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( asin(0.2), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT asin('foo');
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( atan(2), 7), round( atan(-2), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( atan2(-2,2), 7), round( atan2(pi(),0), 7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT ceiling(1.23), ceiling(-1.23);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT cos(pi());
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT degrees(pi()), degrees(pi()/2);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round( exp(2), 7), round( exp(-2), 7), exp(0);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT floor(1.23), floor(-1.23);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(ln(2),7), quote(ln(-2));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT log(2,65536), log(10,100), quote(log(1,100)), quote(log(0,100));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT log2(65536), quote(log2(-100)), quote(log2(0));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(log10(2),7), log10(100), quote(log10(-100));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT mod(234,10), 253%7, mod(29,9), 29%9;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT mod(34.5,3);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT pow(2,2), pow(2,-2);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT power(2,2), power(2,-2);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(radians(90),7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT sign(-32), sign(0), sign(234);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT sin(pi()) BETWEEN -1.0e-15 AND 1.0e-15;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT sqrt(4), round(sqrt(20),7), quote(sqrt(-16));
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT tan(pi()) BETWEEN -1.0e-15 AND 1.0e-15;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT round(tan(pi()+1),7);
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></table><h2>vacuum5</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>PRAGMA auto_vacuum = 0;
CREATE TABLE main.t1(a,b);
WITH RECURSIVE c(x) AS (VALUES(1) UNION ALL SELECT x+1 FROM c WHERE x<1000)
INSERT INTO t1(a,b) SELECT x, randomblob(1000) FROM c;
CREATE TEMP TABLE ttemp(x,y);
INSERT INTO ttemp SELECT * FROM t1;
ATTACH 'test2.db' AS x2;
ATTACH 'test3.db' AS x3;
CREATE TABLE x2.t2(c,d);
INSERT INTO t2 SELECT * FROM t1;
CREATE TABLE x3.t3(e,f);
INSERT INTO t3 SELECT * FROM t1;
DELETE FROM t1 WHERE (rowid%3)!=0;
DELETE FROM t2 WHERE (rowid%4)!=0;
DELETE FROM t3 WHERE (rowid%5)!=0;
PRAGMA main.integrity_check;
PRAGMA x2.integrity_check;
PRAGMA x3.integrity_check;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>VACUUM main;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DELETE FROM t1;
PRAGMA main.integrity_check;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>VACUUM x2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DELETE FROM t2;
PRAGMA x2.integrity_check;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>VACUUM x3;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>VACUUM temp;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>PRAGMA temp.page_count;
</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>PRAGMA temp_store = file;
PRAGMA page_size = 1024;
PRAGMA cache_size = 50;
CREATE TABLE t1(i INTEGER PRIMARY KEY, j UNIQUE);
WITH s(i) AS (
VALUES(1) UNION ALL SELECT i+1 FROM s WHERE i<1000
)
INSERT INTO t1 SELECT NULL, randomblob(100) FROM s;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>VACUUM
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>tkt3731</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr></table><h2>upfrom1</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>DROP TABLE IF EXISTS t2;
CREATE TABLE t2(a INTEGER PRIMARY KEY, b INTEGER, c INTEGER) WITHOUT ROWID;
INSERT INTO t2 VALUES(1, 2, 3);
INSERT INTO t2 VALUES(4, 5, 6);
INSERT INTO t2 VALUES(7, 8, 9);
DROP TABLE IF EXISTS chng;
CREATE TABLE chng(a INTEGER, b INTEGER, c INTEGER);
INSERT INTO chng VALUES(1, 100, 1000);
INSERT INTO chng VALUES(7, 700, 7000);
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT * FROM t2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>UPDATE t2 SET b = chng.b, c = chng.c FROM chng WHERE chng.a = t2.a;
SELECT * FROM t2 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DELETE FROM t2;
INSERT INTO t2 VALUES(1, 2, 3);
INSERT INTO t2 VALUES(4, 5, 6);
INSERT INTO t2 VALUES(7, 8, 9);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>UPDATE t2 SET (b, c) = (SELECT b, c FROM chng WHERE a=t2.a)
WHERE a IN (SELECT a FROM chng);
SELECT * FROM t2 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DROP TABLE IF EXISTS t3;
CREATE TABLE t3(a INTEGER PRIMARY KEY, b INTEGER, c TEXT) WITHOUT ROWID;
INSERT INTO t3 VALUES(1, 1, 'one');
INSERT INTO t3 VALUES(2, 2, 'two');
INSERT INTO t3 VALUES(3, 3, 'three');
DROP TABLE IF EXISTS t4;
CREATE TABLE t4(x TEXT);
INSERT INTO t4 VALUES('five');
SELECT * FROM t3 ORDER BY a;
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>UPDATE t3 SET c=x FROM t4;
SELECT * FROM t3 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DROP TABLE IF EXISTS t2;
CREATE TABLE t2(a INTEGER PRIMARY KEY, b INTEGER, c INTEGER) ;
INSERT INTO t2 VALUES(1, 2, 3);
INSERT INTO t2 VALUES(4, 5, 6);
INSERT INTO t2 VALUES(7, 8, 9);
DROP TABLE IF EXISTS chng;
CREATE TABLE chng(a INTEGER, b INTEGER, c INTEGER);
INSERT INTO chng VALUES(1, 100, 1000);
INSERT INTO chng VALUES(7, 700, 7000);
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>SELECT * FROM t2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>UPDATE t2 SET b = chng.b, c = chng.c FROM chng WHERE chng.a = t2.a;
SELECT * FROM t2 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DELETE FROM t2;
INSERT INTO t2 VALUES(1, 2, 3);
INSERT INTO t2 VALUES(4, 5, 6);
INSERT INTO t2 VALUES(7, 8, 9);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>UPDATE t2 SET (b, c) = (SELECT b, c FROM chng WHERE a=t2.a)
WHERE a IN (SELECT a FROM chng);
SELECT * FROM t2 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DROP TABLE IF EXISTS t3;
CREATE TABLE t3(a INTEGER PRIMARY KEY, b INTEGER, c TEXT) ;
INSERT INTO t3 VALUES(1, 1, 'one');
INSERT INTO t3 VALUES(2, 2, 'two');
INSERT INTO t3 VALUES(3, 3, 'three');
DROP TABLE IF EXISTS t4;
CREATE TABLE t4(x TEXT);
INSERT INTO t4 VALUES('five');
SELECT * FROM t3 ORDER BY a;
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>UPDATE t3 SET c=x FROM t4;
SELECT * FROM t3 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>DROP TABLE IF EXISTS t5;
DROP TABLE IF EXISTS m1;
DROP TABLE IF EXISTS m2;
CREATE TABLE t5(a INTEGER PRIMARY KEY, b TEXT, c TEXT);
CREATE TABLE m1(x INTEGER PRIMARY KEY, y TEXT);
CREATE TABLE m2(u INTEGER PRIMARY KEY, v TEXT);
INSERT INTO t5 VALUES(1, 'one', 'ONE');
INSERT INTO t5 VALUES(2, 'two', 'TWO');
INSERT INTO t5 VALUES(3, 'three', 'THREE');
INSERT INTO t5 VALUES(4, 'four', 'FOUR');
INSERT INTO m1 VALUES(1, 'i');
INSERT INTO m1 VALUES(2, 'ii');
INSERT INTO m1 VALUES(3, 'iii');
INSERT INTO m2 VALUES(1, 'I');
INSERT INTO m2 VALUES(3, 'II');
INSERT INTO m2 VALUES(4, 'III');
</td><td>False</td><td>True</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><td>UPDATE t5 SET b=y, c=v FROM m1 LEFT JOIN m2 ON (x=u) WHERE x=a;
SELECT * FROM t5 ORDER BY a;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t0(a);
CREATE TABLE t1(b);
UPDATE t1 SET b=sum(a) FROM t0;
SELECT * FROM t0, t1;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t1(x INT);  INSERT INTO t1 VALUES(1);
CREATE TABLE t2(y INT);  INSERT INTO t2 VALUES(2);
WITH t1 AS (SELECT y+100 AS x FROM t2)
UPDATE t1 SET x=(SELECT x FROM t1);
SELECT x, y FROM t1, t2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>WITH t1 AS (SELECT y+100 AS x FROM t2)
UPDATE t1 SET x=x+y FROM t2;
SELECT x, y FROM t1, t2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>CREATE TABLE t1(a);
INSERT INTO t1(a) VALUES(5);
CREATE VIEW t2 AS SELECT a FROM t1 UNION ALL SELECT a FROM t1;
CREATE TABLE t3(b,c);
INSERT INTO t3(b,c) VALUES(1,2);
UPDATE t3 SET (c,b) = (SELECT 3,4) FROM t1, t2;
SELECT * FROM t3;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>schemafault</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>CREATE TABLE t2(aaa INTTT);
CREATE VIEW v2(xxx , yyy) AS SELECT aaa, aaa+1 FROM t2;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table><h2>tkt-2ea2425d34</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr></table><h2>cksumvfs</h2><table><tr><th>Query</th><th>Source Success</th><th>clickhouse Success</th><th>clickhouse Shape</th><th>clickhouse Columns</th><th>clickhouse Dtypes</th><th>clickhouse Values</th><th>clickhouse Full Match</th><th>sqlite Success</th><th>sqlite Shape</th><th>sqlite Columns</th><th>sqlite Dtypes</th><th>sqlite Values</th><th>sqlite Full Match</th></tr><tr><td>CREATE TABLE t1(a INTEGER PRIMARY KEY, b);
INSERT INTO t1 VALUES(1, $text);
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><td>SELECT * FROM t1;
</td><td>False</td><td>False</td><td>True</td><td>True</td><td>True</td><td>True</td><td>True</td></tr></table></body></html>